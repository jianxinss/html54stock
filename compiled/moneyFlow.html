<!doctype html>
<html>
    <head>
        <meta http-equiv="content-type" content="text/html;charset=GBK" />
        <script>
function loading(a,b){this.canvas=(typeof a=="String"?document.getElementById(a):a);if(b){this.radius=b.radius||10;this.circleLineWidth=b.circleLineWidth||4;this.circleColor=b.circleColor||"lightgray";this.dotColor=b.dotColor||"gray"}else{this.radius=10;this.circelLineWidth=4;this.circleColor="lightgray";this.dotColor="gray"}}loading.prototype={show:function(){var a=this.canvas;if(!a.getContext){return}if(a.__loading){return}a.__loading=this;var b=a.getContext("2d");var d=this.radius;var e=[{angle:0,radius:1.5},{angle:3/d,radius:2},{angle:7/d,radius:2.5},{angle:12/d,radius:3}];var c=this;a.loadingInterval=setInterval(function(){b.clearRect(0,0,a.width,a.height);var h=c.circleLineWidth;var f={x:a.width/2-d,y:a.height/2-d};b.beginPath();b.lineWidth=h;b.strokeStyle=c.circleColor;b.arc(f.x,f.y,d,0,Math.PI*2);b.closePath();b.stroke();for(var g=0;g<e.length;g++){var j=e[g].currentAngle||e[g].angle;var k={x:f.x-(d)*Math.cos(j),y:f.y-(d)*Math.sin(j)};var l=e[g].radius;b.beginPath();b.fillStyle=c.dotColor;b.arc(k.x,k.y,l,0,Math.PI*2);b.closePath();b.fill();e[g].currentAngle=j+4/d}},50)},hide:function(){var a=this.canvas;a.__loading=false;if(a.loadingInterval){window.clearInterval(a.loadingInterval)}var b=a.getContext("2d");if(b){b.clearRect(0,0,a.width,a.height)}}};var Ajax={};Ajax.request=function(e,g,a,c,f){f=f==undefined?true:f;var d=(window.ActiveXObject?new ActiveXObject("Microsoft.XMLHTTP"):(window.XMLHttpRequest?new XMLHttpRequest():false));var b=document.getElementById(c);if(b&&f){b.loadingObj=new loading(b);b.loadingObj.show()}d.onreadystatechange=function(){if(d.readyState==4&&d.status==200){if(b&&f){b.loadingObj.hide()}a(d)}};d.open(e||"POST",g,true);if(d.overrideMimeType){d.overrideMimeType("text/xml")}d.send()};Ajax.get=function(d,a,b,c){Ajax.request("GET",d,a,b,c)};Ajax.post=function(d,a,b,c){Ajax.request("POST",d,a,b,c)};
</script>
        <title>资金流向</title>        
    </head>
    <body>
    <canvas id="canvas" width="200" height="200" style="border:1px solid #69c"></canvas>

    <script>
function moneyFlowPainter(b,f){this.canvas=document.getElementById(b);var a=this.canvas;if(this.canvas&&this.canvas.getContext){var c=this.canvas.getContext("2d");var g=f.rate;var i=Math.PI*4/5*g/100;var h=i/60;var e=this;var d=h;e.intervalHandler=setInterval(function(){c.save();var n=f.radius||Math.min(a.width,a.height)/2;var j=f.center||{x:a.width/2,y:a.height/2};c.translate(j.x,j.y);j={x:0,y:0};var p=Math.PI*1.4;var m=p+Math.PI/5;c.beginPath();c.moveTo(j.x,j.y);c.arc(j.x,j.y,n,p,m);c.closePath();var k=f.normalColor||"rgb(255,204,51)";c.fillStyle=k;c.fill();c.shadowColor="lightgray";c.shadowBlur=5;c.shadowOffsetX=3;c.shadowOffsetY=3;p=m;m+=Math.PI/10*7;k="rgb(204,51,51)";c.beginPath();c.moveTo(j.x,j.y);c.arc(j.x,j.y,n,p,m);c.closePath();c.fillStyle=k;c.fill();c.shadowColor=null;c.shadowBlur=0;c.shadowOffsetX=0;c.shadowOffsetY=0;p=Math.PI/10*7;m=Math.PI*1.4;k="rgb(0,153,51)";c.beginPath();c.moveTo(j.x,j.y);c.arc(j.x,j.y,n,p,m);c.closePath();c.shadowOffsetX=0;c.fillStyle=k;c.fill();var q=Math.PI*0.1;var o=Math.PI*0.7;var l=Math.PI*2.3;for(;o<l;o+=q){c.beginPath();c.moveTo(j.x,j.y);c.lineTo(j.x+n*Math.cos(o),j.y+n*Math.sin(o));c.strokeStyle="white";c.lineWidth=1;c.closePath();c.stroke()}var r={x:0,y:n/2};c.fillStyle=f.fontColor||"black";c.font=f.font||"12px Arial";c.textAlign="center";c.textBaseline="middle";c.fillText(g+"%",r.x,r.y);c.rotate(d);c.moveTo(0,0);c.lineTo(-3,-3);c.lineTo(0,0-n);c.lineTo(3,-3);c.closePath();c.strokeStyle="gray";c.fillStyle="#333333";c.stroke();c.fill();c.restore();var s=h>0;if(s){if(d<i){d+=h}else{clearInterval(e.intervalHandler)}}else{if(d>i){d+=h}else{clearInterval(e.intervalHandler)}}},20)}}var dataUrl="moneyFlow.xml";Ajax.get(dataUrl,function(a){var d=a.responseXML;var c=d.getElementsByTagName("Item")[0].getElementsByTagName("Item")[0].getAttribute("rate");var b=new moneyFlowPainter("canvas",{rate:c,font:"12px Arial",fontColor:(c>0?"red":(c==0?"black":"green")),radius:60})},"canvas",true);
</script>
    </body>
</html>