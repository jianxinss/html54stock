<!doctype html>
<html>
  <head>
    <title>扇形图</title>
    <meta http-equiv="content-type" content="text/html;charset=GBK"/>
    <script>
(function(){function b(){this.tapTimeLimit=500}Array.prototype.each=function(d,f,c){f=f||0;c=c||this.length-1;for(var e=f;e<=c;e++){d(this[e],this,e);if(this.breakLoop){this.breakLoop=false;break}}};b.prototype={preventDefaultEvent:function(c){if(c.preventDefault){c.preventDefault()}else{c.returnValue=false}},isTouchDevice:function(){return !!("ontouchstart" in window)},toMoney:function(c){return c.toFixed(2)},bigNumberToText:function(d){var c;var f=d/100000000;if(f>1){c=f.toFixed(2)+"亿"}else{var e=d/10000;if(e>1){c=e.toFixed()+"万"}else{c=d}}return c},getOffset:function(c){if(!isNaN(c.offsetX)&&!isNaN(c.offsetY)){return c}var h=c.target;if(h.offsetLeft==undefined){h=h.parentNode}var g=getPageCoord(h);var d={x:window.pageXOffset+c.clientX,y:window.pageYOffset+c.clientY};var f={offsetX:d.x-g.x,offsetY:d.y-g.y};return f},getPageCoord:function(d){var c={x:0,y:0};while(d){c.x+=d.offsetLeft;c.y+=d.offsetTop;d=d.offsetParent}return c},addLoadEvent:function(c){var d=window.onload;if(typeof d!="function"){window.onload=c}else{window.onload=function(){d();c()}}},addEvent:function(c,d,e,g){if(c.addEventListener){c.addEventListener(d,e,g);return true}else{if(c.attachEvent){var f=c.attachEvent("on"+d,e);return f}else{c["on"+d]=e}}},getEventTarget:function(c){return c.srcElement||c.target||c.relatedTarget},$id:function(c){return document.getElementById(c)}};window.extendObject=function(e,c){for(var d in e){c[d]=e[d]}};window.extendWindow=function(c){extendObject(c,window)};var a=new b();extendWindow(a);window.getQueryParam=function(f,c){var e=new RegExp("[?&]"+f+"=([^&]+)","i");var d=e.exec(c?window.top.location.search:location.search);if(d&&d.length>1){return decodeURIComponent(d[1])}else{return""}};window.debug=getQueryParam("debug");window.setDebugMsg=function(d){if(window.debug){try{var f="debug";var e=$id(f);if(!e){e=document.createElement("DIV");e.id=f;document.body.appendChild(e)}e.innerHTML=(window.debug==2?(d+"<br/>"+e.innerHTML):d)}catch(c){alert(d+";error:"+c)}}}})();(function(){function a(){}a.prototype={_clear:function(b){this.ctxs[b.id].clearRect(0,0,b.width,b.height)},_createLayer:function(d,b){if(!d.id){alert("_createCanvas必须指定id");return}if(!this.layers){this.layers={}}if(!this.ctxs){this.ctxs={}}if(!this.drawOptions){this.drawOptions={}}if(this.layers[d.id]){if(b!==false){this._clear(this.layers[d.id])}}else{var e=this.maxZIndex++;var c=document.createElement("canvas");c.id=d.id;c.style.position="absolute";c.style.zIndex=e;c.style.left=this.coords.x+d.left+"px";c.style.top=this.coords.y+d.top+"px";c.width=(d.width||(this.width-d.left));c.height=(d.height||(this.height-d.top));if(this.debug&&d.debug_backgroundColor){c.style.backgroundColor=d.debug_backgroundColor}document.body.appendChild(c);this.layers[d.id]=c;this.ctxs[d.id]=c.getContext("2d");this.drawOptions[d.id]=d}return this.ctxs[d.id]},_drawRect:function(e,g,h,k,f,b,d,c,i,j){i=i||0;j=j||0;e.beginPath();e.rect(g+i,h+j,k,f);e.lineWidth=d||0;e.strokeStyle=c;e.stroke()},_drawLine:function(c,f,g,j,k,b,l,h,i){h=h||0;i=i||0;c.beginPath();var m=f+h;var o=g+i;var n=j+h;var p=k+i;var d=(o==p);var e=(m==n);if(d){if(o*10%10==0){o+=0.5;p+=0.5}}if(e){if(m*10%10==0){m+=0.5;n+=0.5}}c.moveTo(m,o);c.lineTo(n,p);c.strokeStyle=b||"#000000";c.lineWidth=l||1;c.stroke()},_drawText:function(d,f,g,h,e,c,b){d.font=(e||"9pt 宋体");d.textAlign=(b||"left");d.fillStyle=(c||"Black");d.fillText(f,g,h)},_measureText:function(b,d,c){if(c){b.font=c}var e=b.measureText(d).width;return e},_getLayer:function(b){return this.layers[this.canvasId+"_"+b]},_getContext:function(b){return this.ctxs[this.canvasId+"_"+b]},_getOptions:function(b){return this.drawOptions[this.canvasId+"_"+b]}};window._painter=new a()})();function getSectorData(){return[{name:"中国",value:10},{name:"美国",value:30},{name:"英国",value:15},{name:"德国",value:15},{name:"法国",value:10},{name:"日本",value:5},]}function pie(a){this.canvasId=a;this.canvas=$id(a);this.ctx=this.canvas.getContext("2d")}pie.prototype={paint:function(d){if(!d){d={}}if(!d.startAngle){d.startAngle=Math.PI*1.5}var c=d.data;var h=0;c.each(function(j){h+=j.value});if(h==0){(d.noDataFunction||function(){alert("无数据")})();return}c.each(function(j){j.percent=(j.value/h)});var f=d.radius||Math.min(this.canvas.width/2,this.canvas.height/2);this.radius=f;var i=Math.min(this.canvas.width/2,this.canvas.height/2);var a=d.center||{x:i,y:i};this.center=a;this.radium=f;var g=d.startAngle;this.startAngle=g;var e=this;var b=this.ctx;c.each(function(l){var j=l.percent*Math.PI*2;if(g>Math.PI*2){g-=Math.PI*2}var k=g+j;if(k>Math.PI*2){k-=Math.PI*2}b.fillStyle=l.color||e.getRandomColor(l.name);b.beginPath();b.moveTo(a.x,a.y);b.arc(a.x,a.y,f,g,k,false);b.closePath();b.fill();l.range={start:g,end:k};g=k});this.data=c;this.canvas.painter=this;addEvent(this.canvas,"click",this._click);addEvent(this.canvas,"mouseover",this._mouseOver);addEvent(this.canvas,"mousemove",this._mouseMove);addEvent(this.canvas,"mouseout",this._mouseOut)},_getTargetPartRelatedData:function(f,c){var b=f.center;var e={x:c.offsetX-b.x,y:c.offsetY-b.y};var a=Math.atan2(e.y,e.x);if(a<0){a=Math.PI*2+a}var g=e.y/Math.sin(a);if(Math.abs(g)>f.radium){setDebugMsg("不在圆形范围内"+e.x+","+e.y,false);return null}setDebugMsg("在圆内，开始计算扇形区域"+e.x+","+e.y);var d=null;f.data.each(function(i,h){var j=i.range;if(j.start<=j.end){if(j.start<=a&&j.end>=a){h.breakLoop=true;d=i}}else{var k=[{start:j.start,end:Math.PI*2},{start:0,end:j.end}];k.each(function(l,m){if(l.start<=a&&l.end>=a){m.breakLoop=true;d=i;h.breakLoop=true}})}});if(d){setDebugMsg("mouse point to:"+d.name)}else{setDebugMsg("mouse point to: null")}return d},_mouseOver:function(a){},_mouseMove:function(b){b=b||event;getOffset(b);var d=getEventTarget(b);var c=d.painter;var a=c._getTargetPartRelatedData(c,b)},_mouseOut:function(a){},_click:function(b){b=b||event;getOffset(b);var h=getEventTarget(b);var e=h.painter;var a=e._getTargetPartRelatedData(e,b);setDebugMsg("you click "+a.name);e.clickedData=a;var d=e.moveStep||1;e.pieOffset=0;var g=e.startAngle;var c=e.radius/10;var f=e.radius;e.intervalHandler=setInterval(function(){if(e.pieOffset>c){clearInterval(e.intervalHandler);return}e.ctx.clearRect(0,0,e.canvas.width,e.canvas.height);e.randomColorMaxIndex=false;e.usedColor=[];e.pieOffset+=d;var i=e.ctx;e.data.each(function(l){var j=l.percent*Math.PI*2;if(g>Math.PI*2){g-=Math.PI*2}var k=g+j;if(k>Math.PI*2){k-=Math.PI*2}i.fillStyle=l.color||e.getRandomColor(l.name);i.beginPath();var n={x:e.center.x,y:e.center.y};if(e.clickedData&&l==e.clickedData){var m=g<=k?(g+k)/2:(g+k+Math.PI*2)/2;n.x=n.x+e.pieOffset*Math.cos(m);n.y=n.y+e.pieOffset*Math.sin(m)}i.moveTo(n.x,n.y);i.arc(n.x,n.y,f,g,k,false);i.closePath();i.fill();l.range={start:g,end:k};g=k})},50)},getRandomColor:function(d){var c=this.canvasId+"$"+d;var a=this.colors||defaultColors;if(!this.usedColor){this.usedColor=[]}var b;var f="Red";var e=this;var g=e.randomColorMaxIndex||0;do{f=a[g];if(a.length==e.usedColor.length){break}e.usedColor.each(function(i,h){b=(i==f);if(b){h.breakLoop=true}});g++}while(b);e.randomColorMaxIndex=g;e.usedColor.push(f);return f}};var defaultColors=["#FF0000","#00FF00","#0000FF","#FF00FF","#00FFFF","#FFFF00","#000000","#70DB93","#5C3317","#9F5F9F","#B5A642","#D9D919","#A67D3D","#8C7853","#5F9F9F","#B87333","#FF7F00","#42426F","#5C4033","#2F4F2F","#4A766E","#4F4F2F","#9932CD","#871F78","#6B238E","#2F4F4F","#97694F","#7093DB","#855E42","#545454","#545454","#D19275","#8E2323","#238E23","#CD7F32","#DBDB70","#C0C0C0","#527F76","#93DB70","#215E21","#4E2F2F","#9F9F5F","#C0D9D9","#A8A8A8","#8F8FBD","#E9C2A6","#32CD32","#E47833","#8E236B","#32CD99","#3232CD","#6B8E23","#EAEAAE","#9370DB","#426F42","#7F00FF","#7FFF00","#70DBDB","#DB7093","#A68064","#2F2F4F","#23238E","#4D4DFF","#FF6EC7","#00009C","#EBC79E","#CFB53B","#FF7F00","#FF2400","#DB70DB","#8FBC8F","#BC8F8F","#EAADEA","#D9D9F3","#5959AB","#6F4242","#BC1717","#238E68","#6B4226","#8E6B23","#E6E8FA","#3299CC","#007FFF","#FF1CAE","#00FF7F","#236B8E","#38B0DE","#DB9370","#D8BFD8","#ADEAEA","#5C4033","#CDCDCD","#4F2F4F","#CC3299","#D8D8BF","#99CC32"];addLoadEvent(function(){var a=new pie("canvasSector");a.paint({radius:80,data:getSectorData()})});function setDebugMsg(a){$id("debug").innerHTML=a};
</script>
  </head>
  
  <body>
  
    <canvas id="canvasSector" width="200" height="200" style="background:#f0f0f0;border:1px solid #eee;">
    您的浏览器不支持哟
    </canvas>
  
    <div id="debug"></div>

  </body>
  
</html>