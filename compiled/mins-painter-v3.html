<!doctype html>
<html>
<head>
    <meta http-equiv="content-type" content="text/html;charset=GBK" />
    <title>html 5 minutes chart painter</title>
    <script>
function loading(a,b){this.canvas=(typeof a=="String"?document.getElementById(a):a);if(b){this.radius=b.radius||10;this.circleLineWidth=b.circleLineWidth||4;this.circleColor=b.circleColor||"lightgray";this.dotColor=b.dotColor||"gray"}else{this.radius=10;this.circelLineWidth=4;this.circleColor="lightgray";this.dotColor="gray"}}loading.prototype={show:function(){var a=this.canvas;if(!a.getContext){return}if(a.__loading){return}a.__loading=this;var b=a.getContext("2d");var d=this.radius;var e=[{angle:0,radius:1.5},{angle:3/d,radius:2},{angle:7/d,radius:2.5},{angle:12/d,radius:3}];var c=this;a.loadingInterval=setInterval(function(){b.clearRect(0,0,a.width,a.height);var h=c.circleLineWidth;var f={x:a.width/2-d,y:a.height/2-d};b.beginPath();b.lineWidth=h;b.strokeStyle=c.circleColor;b.arc(f.x,f.y,d,0,Math.PI*2);b.closePath();b.stroke();for(var g=0;g<e.length;g++){var j=e[g].currentAngle||e[g].angle;var k={x:f.x-(d)*Math.cos(j),y:f.y-(d)*Math.sin(j)};var l=e[g].radius;b.beginPath();b.fillStyle=c.dotColor;b.arc(k.x,k.y,l,0,Math.PI*2);b.closePath();b.fill();e[g].currentAngle=j+4/d}},50)},hide:function(){var a=this.canvas;a.__loading=false;if(a.loadingInterval){window.clearInterval(a.loadingInterval)}var b=a.getContext("2d");if(b){b.clearRect(0,0,a.width,a.height)}}};(function(){function b(){this.tapTimeLimit=500}Array.prototype.each=function(d,f,c){f=f||0;c=c||this.length-1;for(var e=f;e<=c;e++){d(this[e],this,e);if(this.breakLoop){this.breakLoop=false;break}}};b.prototype={preventDefaultEvent:function(c){if(c.preventDefault){c.preventDefault()}else{c.returnValue=false}},isTouchDevice:function(){return !!("ontouchstart" in window)},toMoney:function(c){return c.toFixed(2)},bigNumberToText:function(d){var c;var f=d/100000000;if(f>1){c=f.toFixed(2)+"вк"}else{var e=d/10000;if(e>1){c=e.toFixed()+"Эђ"}else{c=d}}return c},getOffset:function(c){if(!isNaN(c.offsetX)&&!isNaN(c.offsetY)){return c}var h=c.target;if(h.offsetLeft==undefined){h=h.parentNode}var g=getPageCoord(h);var d={x:window.pageXOffset+c.clientX,y:window.pageYOffset+c.clientY};var f={offsetX:d.x-g.x,offsetY:d.y-g.y};return f},getPageCoord:function(d){var c={x:0,y:0};while(d){c.x+=d.offsetLeft;c.y+=d.offsetTop;d=d.offsetParent}return c},addLoadEvent:function(c){var d=window.onload;if(typeof d!="function"){window.onload=c}else{window.onload=function(){d();c()}}},addEvent:function(c,d,e,g){if(c.addEventListener){c.addEventListener(d,e,g);return true}else{if(c.attachEvent){var f=c.attachEvent("on"+d,e);return f}else{c["on"+d]=e}}},getEventTarget:function(c){return c.srcElement||c.target||c.relatedTarget},$id:function(c){return document.getElementById(c)}};window.extendObject=function(e,c){for(var d in e){c[d]=e[d]}};window.extendWindow=function(c){extendObject(c,window)};var a=new b();extendWindow(a);window.getQueryParam=function(f,c){var e=new RegExp("[?&]"+f+"=([^&]+)","i");var d=e.exec(c?window.top.location.search:location.search);if(d&&d.length>1){return decodeURIComponent(d[1])}else{return""}};window.debug=getQueryParam("debug");window.setDebugMsg=function(d){if(window.debug){try{var f="debug";var e=$id(f);if(!e){e=document.createElement("DIV");e.id=f;document.body.appendChild(e)}e.innerHTML=(window.debug==2?(d+"<br/>"+e.innerHTML):d)}catch(c){alert(d+";error:"+c)}}}})();var dashSize=2;function Painter(a,c,b){this.canvas=document.getElementById(a);if(!this.canvas.getContext){return}this.ctx=this.canvas.getContext("2d");this.data=b;this.paintImplement=c;this.width=this.canvas.width;this.height=this.canvas.height}Painter.prototype={paint:function(){var e=this.paintImplement;var b=this.data;var a=this.ctx;if(typeof e.initialize=="function"){e.initialize(this)}if(e.start){e.start.call(this)}if(typeof e.paintItems=="function"){e.paintItems.call(this)}else{var c=((typeof e.getDataLength=="function")?e.getDataLength.call(this):this.data.length);for(var d=0;d<c;d++){var f=e.getX?e.getX.call(this,d):undefined;var g=e.getY?e.getY.call(this,d):undefined;e.paintItem.call(this,d,f,g)}}if(e.end){e.end.call(this)}},drawHLine:function(a,g,h,e,d,c){var b=this.ctx;b.strokeStyle=a;if(h*10%10==0){h+=0.5}if(c&&c=="dashed"){var f=0;do{this.drawHLine(a,f,h,dashSize,1,"solid");f+=dashSize*2}while(f<e)}else{b.beginPath();b.moveTo(g,h);b.lineTo(g+e,h);b.stroke()}},drawVLine:function(a,g,i,c,f,e){var b=this.ctx;b.strokeStyle=a;if(g*10%10==0){g+=0.5}if(e&&e=="dashed"){var d=0;do{this.drawVLine(a,g,d,dashSize,1);d+=dashSize*2}while(d<c)}else{b.beginPath();b.moveTo(g,i);b.lineTo(g,i+c);b.stroke()}},setData:function(a){this.data=a},setPainterImplement:function(a){this.paintImplement=a}};var Ajax={};Ajax.request=function(e,g,a,c,f){f=f==undefined?true:f;var d=(window.ActiveXObject?new ActiveXObject("Microsoft.XMLHTTP"):(window.XMLHttpRequest?new XMLHttpRequest():false));var b=document.getElementById(c);if(b&&f){b.loadingObj=new loading(b);b.loadingObj.show()}d.onreadystatechange=function(){if(d.readyState==4&&d.status==200){if(b&&f){b.loadingObj.hide()}a(d)}};d.open(e||"POST",g,true);if(d.overrideMimeType){d.overrideMimeType("text/xml")}d.send()};Ajax.get=function(d,a,b,c){Ajax.request("GET",d,a,b,c)};Ajax.post=function(d,a,b,c){Ajax.request("POST",d,a,b,c)};function crossLines(a){this.updateOptions(a)}crossLines.prototype={updateOptions:function(a){this.canvas=a.canvas;this.canvasId=this.canvas.id;this.horizontalDivId=this.canvasId+"_crossLines_H";this.verticalDivId=this.canvasId+"_crossLines_V";this.verticalRange=a.verticalRange||{y1:0,y2:this.canvas.height};this.horizontalRange=a.horizontalRange||{x1:0,x2:this.canvas.width};this.canvasPosition=getPageCoord(this.canvas);this.crossPoint=a.crossPoint;this.color=a.color||"black"},removeCrossLines:function(){var a=this.canvas;var b=a.id;var c=b+"_crossLines_H";var f=b+"_crossLines_V";var d=$id(c);if(d){d.style.display="none"}var e=$id(f);if(e){e.style.display="none"}},getHLine:function(){return $id(this.horizontalDivId)},getVLine:function(){return $id(this.verticalDivId)},setMouseEvents:function(a,b){this.hLineMouseEvt=a;this.vLineMouseEvt=b},updateCrossPoint:function(a){this.crossPoint=a;this.drawCrossLines()},drawCrossLines:function(){var a=this.canvas;var b=this.canvas.id;var f=b+"_crossLines_H";var i=b+"_crossLines_V";var h=this.verticalRange||{y1:0,y2:a.height};var g=this.horizontalRange||{x1:0,x2:a.width};var c=this.canvasPosition;if(this.crossPoint.x<g.x1||this.crossPoint.x>g.x2||this.crossPoint.y<h.y1||this.crossPoint.y>h.y2){this.removeCrossLines();return}var k=(a.style.zIndex||1)+1;var d=false;var e;if($id(f)){d=true;e=$id(f)}else{e=document.createElement("DIV");e.id=f}e.style.display="block";e.style.position="absolute";e.style.width=Math.round(g.x2-g.x1)+"px";e.style.height="1px";e.style.left=Math.round(c.x+g.x1)+"px";e.style.top=Math.round(this.crossPoint.y+c.y)+"px";e.style.backgroundColor=this.color;e.style.zIndex=k;if(!d){document.body.appendChild(e);if(typeof this.hLineMouseEvt=="function"){addEvent(e,"mouseover",this.hLineMouseEvt);addEvent(e,"mousemove",this.hLineMouseEvt)}}d=false;var j;if($id(i)){d=true;j=$id(i)}else{j=document.createElement("DIV");j.id=i}j.style.display="block";j.style.position="absolute";j.style.height=Math.round(h.y2-h.y1)+"px";j.style.width="1px";j.style.left=Math.round(this.crossPoint.x+c.x)+"px";j.style.top=Math.round(h.y1+c.y)+"px";j.style.backgroundColor=this.color;j.style.index=k;if(!d){document.body.appendChild(j);if(typeof this.vLineMouseEvt=="function"){addEvent(j,"mouseover",this.vLineMouseEvt);addEvent(j,"mousemove",this.vLineMouseEvt)}}}};function xAxis(a){this.options=a}xAxis.prototype={initialize:function(a){a.options=this.options},start:function(){var a=this.ctx;a.save();a.fillStyle=this.options.color;a.font=this.options.font;if(this.options.textBaseline){a.textBaseline=this.options.textBaseline}a.translate(this.options.region.x,this.options.region.y)},getY:function(){return 0},getX:function(a){if(a==0){return 0}var b=this.ctx.measureText(this.data[a]).width;if(a==this.data.length-1){return this.options.region.width-b}return(this.options.region.width*a/(this.data.length-1))-b/2},paintItem:function(a,b,c){this.ctx.fillText(this.data[a],b,c)},end:function(){this.ctx.restore()}};function linePainter(a){this.options=a}linePainter.prototype={initialize:function(a){a.options=this.options},getDataLength:function(){return this.options.getDataLength.call(this)},getX:function(a){return(a+1)*(this.options.region.width/this.options.maxDotsCount)},start:function(){var a=this.ctx;var d=this.options;var e=d.region;a.save();a.translate(e.x,e.y+e.height/2);var b=0;var c=this;this.data.items.each(function(g){var f=Math.abs(d.middleValue-d.getItemValue(g));b=Math.max(f,b)});this.maxDiff=b;a.beginPath();a.strokeStyle=d.lineColor},end:function(){this.ctx.stroke();this.ctx.restore()},getY:function(b){var c=this.options;var a=c.getItemValue(this.data.items[b])-c.middleValue;return 0-a*c.region.height/2/this.maxDiff},paintItem:function(b,c,d){var a=this.ctx;if(b==0){a.moveTo(c,d)}else{a.lineTo(c,d)}}};function volumePainter(a){this.options=a;this.barWidth=a.bar.width;this.spaceWidth=a.region.width/a.maxDotsCount-a.bar.width;if(this.spaceWidth<1){this.spaceWidth=0}if(this.barWidth*a.maxDotsCount>a.region.width){this.barWidth=a.region.width/a.maxDotsCount}}volumePainter.prototype={initialize:function(a){a.options=this.options;a.barWidth=this.barWidth;a.spaceWidth=this.spaceWidth},getDataLength:function(){return this.options.getDataLength.call(this)},getX:function(a){return this.options.region.x+a*(this.barWidth+this.spaceWidth)},start:function(){var a=this.ctx;var c=this.options;var d=c.region;a.save();var b=0;this.data.items.each(function(e){b=Math.max(b,e.volume)});this.maxVolume=b;a.fillStyle=c.bar.color},end:function(){this.ctx.restore()},getY:function(b){var a=this.options.region.y+(this.maxVolume-this.data.items[b].volume)*this.options.region.height/this.maxVolume;return a},paintItem:function(b,c,d){var a=this.ctx;a.beginPath();a.rect(c,d,this.barWidth,this.options.region.y+this.options.region.height-d);a.fill()}};function yAxis(a){this.scalerOptions=a}yAxis.prototype={initialize:function(a){a.scalerOptions=this.scalerOptions},start:function(){var a=this.ctx;a.save();if(typeof this.scalerOptions.color=="string"){a.fillStyle=this.scalerOptions.color}a.font=this.scalerOptions.font;a.translate(this.scalerOptions.region.x,this.scalerOptions.region.y);if(this.scalerOptions.textBaseline){a.textBaseline=this.scalerOptions.textBaseline}},end:function(){this.ctx.restore()},getX:function(a){if(this.scalerOptions.align=="left"){return 0}var b=this.ctx.measureText(this.data[a]).width;return this.scalerOptions.region.width-b},getY:function(a){if(a==0){return 0}if(a==this.data.length-1){return this.scalerOptions.region.height-this.scalerOptions.fontHeight}return(this.scalerOptions.region.height*a/(this.data.length-1)-this.scalerOptions.fontHeight/2)},paintItem:function(a,b,c){if(typeof this.scalerOptions.color=="function"){this.ctx.fillStyle=this.scalerOptions.color(this.data[a])}this.ctx.fillText(this.data[a],b,c)}};function calcAxisValues(d,f,a,c){var b=d-f;var h=b/(a-1);var g=[];if(typeof c=="undefined"){c=toMoney}for(var e=0;e<a;e++){g.push(toMoney(d-e*h))}return g}function disableBubbleAndPreventDefault(a){if(a.preventDefault){a.preventDefault()}a.cancelBubble=true}function setTouchEventOffsetPosition(a,d){a=a||event;if(a.touches&&a.touches.length){a=a.touches[0]}else{if(a.changedTouches&&a.changedTouches.length){a=a.changedTouches[0]}}var b,c;b=a.pageX-d.x;c=a.pageY-d.y;return{offsetX:b,offsetY:c}}function crossLinesAndTipMgr(a,b){if(typeof Tip!="function"){window.Tip=function(){};window.Tip.prototype={show:function(){},hide:function(){},update:function(){}}}this.canvas=a;this.options=b}crossLinesAndTipMgr.prototype._removeTipAndCrossLines=function(){var a=this;if(a.tip){a.tip.hide()}if(a.clsMgr){a.clsMgr.removeCrossLines()}};crossLinesAndTipMgr.prototype.updateOptions=function(a){this.options=a};crossLinesAndTipMgr.prototype._onMouseOrTouchMove=function(f){f=f||event;f=getOffset(f);var g=this;var h=g.options;var a=g.canvas;var b=getPageCoord(a);var i=h.triggerEventRanges;if(f.offsetX<i.x||f.offsetX>i.x+i.width||f.offsetY<i.y||f.offsetY>i.y+i.height){g._removeTipAndCrossLines();return}var e=h.getCrossPoint(f);var d={crossPoint:e,verticalRange:{y1:i.y,y2:i.y+i.height},horizontalRange:{x1:i.x,x2:i.x+i.width},color:h.crossLineOptions.color,canvas:a};if(!g.clsMgr){var c=new crossLines(d);c.setMouseEvents(function(l){l=l||event;l=getOffset(l);var n={offsetX:l.offsetX+i.x,offsetY:parseInt(g.clsMgr.getHLine().style.top)-b.y};var m=h.getCrossPoint(n);c.updateCrossPoint(m);if(g.tip){g.tip.update(m,h.tipOptions.getTipHtml(n))}},function(l){l=l||event;l=getOffset(l);var n={offsetX:parseInt(g.clsMgr.getVLine().style.left)-b.x,offsetY:l.offsetY+i.y};var m=h.getCrossPoint(n);c.updateCrossPoint(m);if(g.tip){g.tip.update(m,h.tipOptions.getTipHtml(n))}});g.clsMgr=c}else{g.clsMgr.updateOptions(d)}g.clsMgr.drawCrossLines();if(h.tipOptions){var k=h.tipOptions;if(!g.tip){var j=new Tip({position:{x:k.position.x||false,y:k.position.y||false},size:k.size,opacity:k.opacity||80,cssClass:k.cssClass,offsetToPoint:k.offsetToPoint||30,relativePoint:{x:e.x,y:e.y},canvas:a,canvasRange:h.triggerEventRanges,innerHTML:k.getTipHtml(f)});g.tip=j}g.tip.show(e,k.getTipHtml(f))}};crossLinesAndTipMgr.prototype._touchstart=function(a){a=a||event;disableBubbleAndPreventDefault(a);var b=a.srcElement||a.target||a.relatedTarget;this.touchstartTime=new Date()};crossLinesAndTipMgr.prototype._touchmove=function(b){b=b||event;disableBubbleAndPreventDefault(b);var a=this.canvas;var d=getPageCoord(a);var f=b.srcElement||b.target||b.relatedTarget;var c=setTouchEventOffsetPosition(b,d);this._onMouseOrTouchMove(c)};crossLinesAndTipMgr.prototype._touchend=function(b){b=b||event;disableBubbleAndPreventDefault(b);var d=b.srcElement||b.target||b.relatedTarget;var a=this.canvas;var c=setTouchEventOffsetPosition(b,getPageCoord(a));this._removeTipAndCrossLines();var f=new Date();var g=f.getTime()-this.touchstartTime.getTime();if(g<200){if(typeof this.options.onClick=="function"){this.options.onClick()}}};crossLinesAndTipMgr.prototype._mouseout=function(b){var a=b||event;b=getOffset(a);var c=this;var d=c.options.triggerEventRanges;if(b.offsetX<=d.x||b.offsetX>=d.x+d.width||b.offsetY<=d.y||b.offsetY>=d.y+d.height){c._removeTipAndCrossLines();return}var f=a.toElement||a.relatedTarget||a.target;if(f){if(f==c.canvas){return}if(f==c.clsMgr.getHLine()||f==c.clsMgr.getVLine()){return}c._removeTipAndCrossLines()}};crossLinesAndTipMgr.prototype.addCrossLinesAndTipEvents=function(){var a=this.canvas;var d=this.options;var b=getPageCoord(a);if(a.addCrossLinesAndTipEvents==true){return}a.addCrossLinesAndTipEvents=true;var e=isTouchDevice();var c=this;if(e){addEvent(a,"touchstart",function(f){c._touchstart.call(c,f)});addEvent(a,"touchmove",function(f){c._touchmove.call(c,f)});addEvent(a,"touchend",function(f){c._touchend.call(c,f)})}else{addEvent(a,"mouseout",function(f){c._mouseout.call(c,f)});addEvent(a,"mousemove",function(f){c._onMouseOrTouchMove.call(c,f)});if(typeof d.onClick=="function"){addEvent(a,"click",d.onClick)}}};function addCrossLinesAndTipEvents(a,b){if(!a.crossLineAndTipMgrInstance){a.crossLineAndTipMgrInstance=new crossLinesAndTipMgr(a,b);a.crossLineAndTipMgrInstance.addCrossLinesAndTipEvents()}};
</script>
</head>
<body>
    <canvas id="canvas" width="414" height="310" style="z-index: 3; background: transparent;
        border: 1px solid #69c">
        <p>
            ФуЕФфЏРРЦїВЛжЇГжhtml5гД</p>
    </canvas>
    <div id="debug"></div>
    <!--
    options:{
        fallColor:'green',riseColor:'red',normalColor:'black',
        topText:{font:'11px ЫЮЬх',color:'black',region:{x:.5,y:.5,width:213,height:20}},
        minsChart:{region:{x:2,y:20,width:180,height:150},priceLineColor:'blue',middleLineColor:'red',otherSplitLineColor:'lightgray',borderColor:'gray'},
        xScaler:{font:'11px ЫЮЬх',color:black,region:{x:5,y:130,width:180,height:20}},
        bottomText:{font:'11px ЫЮЬх',color:'black',region:{x:5,y:130,width:213,height:20}}
    }
    -->
    <script src="mins-data.js"></script><!---->
    <script>
function line(b,d,f,e,g,a,c){b.beginPath();b.moveTo(d,f);b.lineTo(e,g);b.strokeStyle=a;b.lineWidth=c||1;b.stroke()}function getMinTime(c){var a=new Date();if(c<=120){a.setHours(9,30,30);a=new Date(a.getTime()+(c)*60*1000)}else{a.setHours(13,0,0);a=new Date(a.getTime()+(c-120)*60*1000)}var b=a.getHours()>9?new String(a.getHours()):"0"+a.getHours();var e=a.getMinutes()>9?new String(a.getMinutes()):"0"+a.getMinutes();var f="30";return b+""+e+f}function Tip(a){this.options=a;this.canvas=a.canvas;this.canvas.tip=this}Tip.prototype={show:function(d,b){var a=this.dataContext;var c=this.canvas.painter;if(a){if(a.isNewQuote){c.fillTopText(a.data)}else{c.fillTopText(a.data,a.index)}}},update:function(b,a){this.show(b,a)},hide:function(){var a=this.dataContext;var b=this.canvas.painter;if(a){b.fillTopText(a.data)}}};function minsChart(a,b){extendObject(b,this);this.canvas=$id(a);this.ctx=this.canvas.getContext("2d");this.canvas.painter=this}minsChart.prototype={paint:function(a){this.fillTopText(a);this.paintChart(a);this.paintxAxis();this.fillBottomText(a);this.paintVolume(a)},paintVolume:function(b){var a=this.ctx;var d=this.volume;a.beginPath();a.rect(d.region.x,d.region.y,d.region.width,d.region.height);a.strokeStyle=d.borderColor;a.stroke();line(a,d.region.x,d.region.y+d.region.height/2,d.region.x+d.region.width,d.region.y+d.region.height/2,d.splitLineColor);d.getDataLength=function(){return this.data.items.length};d.maxDotsCount=this.maxDotsCount;var h=new volumePainter(d);var e=new Painter(this.canvas.id,h,{items:b.mins});e.paint();var c=e.maxVolume;var g;if(c/1000000>1000){c=c/1000000;g="АйЭђ"}else{c=c/10000;g="Эђ"}var f=[c.toFixed(2),(c/2).toFixed(2),"("+g+")"];var i=new yAxis(this.volume.yScaler);var e=new Painter(this.canvas.id,i,f);e.paint()},fillBottomText:function(c){if(!this.bottomText){return}var b=this.ctx;var l="Ип";var j=this.bottomText;b.font=j.font;b.fillStyle=j.color;var m=b.measureText(l).width;b.fillText(l,j.region.x,j.region.y);var n=j.region.x+m;var k=c.quote;var i=this;function d(o){return o>k.preClose?i.riseColor:(o==k.preClose?i.normalColor:i.fallColor)}var f=d(k.highest);var e=toMoney(k.highest);b.fillStyle=f;m=b.measureText(e).width;b.fillText(e,n,j.region.y);n+=m;l=" ЕЭ";b.fillStyle=j.color;m=b.measureText(l).width;b.fillText(l,n,j.region.y);n+=m;var h=d(k.lowest);var g=toMoney(k.lowest);m=b.measureText(g).width;b.fillStyle=h;b.fillText(g,n,j.region.y);n+=m;b.fillStyle=j.color;var a=" ГЩНЛ"+bigNumberToText(k.amount);b.fillText(a,n,j.region.y)},paintxAxis:function(){var a=new xAxis(this.xScaler);var b=new Painter(this.canvas.id,a,this.xScaler.data);b.paint()},paintChart:function(d){var n=this.minsChart;var s=this.minsChart.region;var c=this.ctx;c.beginPath();c.strokeStyle=n.borderColor;c.rect(s.x,s.y,s.width,s.height);c.stroke();var l=(this.minsChart.horizontalLineCount+this.minsChart.horizontalLineCount%2)/2;var w=this.minsChart.horizontalLineCount+1;for(var f=1;f<=this.minsChart.horizontalLineCount;f++){var b=(f==l?n.middleLineColor:n.otherSplitLineColor);var D=s.y+s.height*f/w;line(c,s.x,D,s.x+s.width,D,b)}w=this.minsChart.verticalLineCount+1;for(var f=1;f<=this.minsChart.verticalLineCount;f++){var C=s.x+s.width*f/w;line(c,C,s.y,C,s.y+s.height,n.otherSplitLineColor)}var h={region:s,maxDotsCount:this.maxDotsCount,getDataLength:function(){return this.data.items.length},getItemValue:function(i){return i.price},middleValue:d.quote.preClose,lineColor:n.priceLineColor};var j=new linePainter(h);var r=new Painter(this.canvas.id,j,{items:d.mins});r.paint();var F=this.minsChart.yScalerLeft;var q=d.quote.preClose;var k=this;F.color=function(i){return i>q?k.riseColor:(i==q?k.normalColor:k.fallColor)};var t=[];var u=[];var m=q-r.maxDiff;var v=r.maxDiff*2/(this.minsChart.horizontalLineCount+1);for(var f=this.minsChart.horizontalLineCount+1;f>=0;f--){var B=m+f*v;t.push(B.toFixed(2));var p=(B-q)*100/q;u.push(p.toFixed(2)+"%")}var H=new yAxis(F);var E=new Painter(this.canvas.id,H,t);E.paint();var G=this.minsChart.yScalerRight;G.color=function(i){return(i=="0.00%"?"black":(i.charAt(0)=="-"?"green":"red"))};var I=new yAxis(G);var J=new Painter(this.canvas.id,I,u);J.paint();if(this.needPaintAvgPriceLine){var g=[];var A=0;var z=0;d.mins.each(function(i){A+=i.volume;z+=i.amount;g.push(z/A)});h.lineColor=n.avgPriceLineColor;h.getItemValue=function(i){return i};j=new linePainter(h);var o=new Painter(this.canvas.id,j,{items:g});o.paint()}var k=this;var a=k.minsChart.region;function e(N){var y=Math.ceil((N-k.minsChart.region.x)*k.maxDotsCount/k.minsChart.region.width);var M;var K;if(y>=0&&y<d.mins.length){M=d.mins[y].price;K=false}else{M=d.quote.price;K=true}if(k.canvas.tip){k.canvas.tip.dataContext={data:d,isNewQuote:K,index:y}}var i=M-q;var L=(k.minsChart.region.y+k.minsChart.region.height/2);return L-i*k.minsChart.region.height/2/r.maxDiff}addCrossLinesAndTipEvents(this.canvas,{getCrossPoint:function(i){return{x:i.offsetX,y:e(i.offsetX)}},triggerEventRanges:{x:a.x,y:a.y,width:a.width,height:k.volume.region.y+k.volume.region.height-a.y},tipOptions:{getTipHtml:function(i){return null},position:{x:false,y:false}},crossLineOptions:{color:"black"}})},fillTopText:function(b,g){var i=b.quote;var a=this.ctx;var n=this.topText;var j=n.region;a.clearRect(j.x,j.y,j.width,j.height);var h;var l;if(typeof g=="undefined"){h=i.price;l=i.time}else{h=b.mins[g].price;l=i.time.toString().substr(0,8)+getMinTime(g)}a.fillStyle=n.color;a.font=n.font;if(n.textBaseline){a.textBaseline=n.textBaseline}var o="зюаТ"+toMoney(h);var r=a.measureText(o).width;a.fillText(o,n.region.x,n.region.y);var f=h>i.preClose;var d=h==i.preClose;var e=h<i.preClose;var c=toMoney(h-i.preClose);var p=(f?"Ёќ":(e?"Ё§":""))+c+("(")+toMoney(c*100/i.preClose)+"%)";var s=n.region.x+r;a.fillStyle=f?this.riseColor:(e?this.fallColor:this.normalColor);a.fillText(p,s,n.region.y);var k=new String(l);var q=k.charAt(8)+k.charAt(9)+":"+k.charAt(10)+k.charAt(11);a.fillStyle=n.color;var m=a.measureText(q).width;a.fillText(q,n.region.x+n.region.width-m,n.region.y)}};var chart=new minsChart("canvas",{fallColor:"green",riseColor:"red",normalColor:"black",maxDotsCount:241,needPaintAvgPriceLine:false,backgroundColor:"white",topText:{font:"12px ЫЮЬх",color:"black",region:{x:58.5,y:5.5,width:305,height:14},textBaseline:"top"},minsChart:{region:{x:56.5,y:21.5,width:310,height:200},priceLineColor:"blue",avgPriceLineColor:"red",middleLineColor:"red",otherSplitLineColor:"lightgray",borderColor:"gray",horizontalLineCount:7,verticalLineCount:3,yScalerLeft:{font:"12px Arial",region:{x:0.5,y:20,width:50.5,height:200},align:"right",fontHeight:9,textBaseline:"top"},yScalerRight:{font:"12px Arial",region:{x:368.5,y:20,width:40.5,height:200},align:"right",fontHeight:9,textBaseline:"top"}},xScaler:{font:"12px Arial",color:"black",region:{x:56.5,y:225,width:310,height:20},data:["09:30","10:30","11:30/13:00","14:00","15:00"]},volume:{region:{x:56.5,y:245.5,width:310,height:60},bar:{color:"green",width:2},borderColor:"lightgray",splitLineColor:"lightgray",yScaler:{font:"12px Arial",region:{x:0.5,y:242.5,width:50.5,height:60},color:"black",align:"right",fontHeight:12,textBaseline:"top"}}});var data=getQuote();chart.paint(data);
</script>
</body>
</html>
