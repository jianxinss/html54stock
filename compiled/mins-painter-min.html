<!doctype html>
<html>
<head>
    <meta http-equiv="content-type" content="text/html;charset=GBK" />
    <title>html 5 minutes chart painter</title>
    <script>
function loading(a,b){this.canvas=(typeof a=="String"?document.getElementById(a):a);if(b){this.radius=b.radius||10;this.circleLineWidth=b.circleLineWidth||4;this.circleColor=b.circleColor||"lightgray";this.dotColor=b.dotColor||"gray"}else{this.radius=10;this.circelLineWidth=4;this.circleColor="lightgray";this.dotColor="gray"}}loading.prototype={show:function(){var a=this.canvas;if(!a.getContext){return}if(a.__loading){return}a.__loading=this;var b=a.getContext("2d");var d=this.radius;var e=[{angle:0,radius:1.5},{angle:3/d,radius:2},{angle:7/d,radius:2.5},{angle:12/d,radius:3}];var c=this;a.loadingInterval=setInterval(function(){b.clearRect(0,0,a.width,a.height);var h=c.circleLineWidth;var f={x:a.width/2-d,y:a.height/2-d};b.beginPath();b.lineWidth=h;b.strokeStyle=c.circleColor;b.arc(f.x,f.y,d,0,Math.PI*2);b.closePath();b.stroke();for(var g=0;g<e.length;g++){var j=e[g].currentAngle||e[g].angle;var k={x:f.x-(d)*Math.cos(j),y:f.y-(d)*Math.sin(j)};var l=e[g].radius;b.beginPath();b.fillStyle=c.dotColor;b.arc(k.x,k.y,l,0,Math.PI*2);b.closePath();b.fill();e[g].currentAngle=j+4/d}},50)},hide:function(){var a=this.canvas;a.__loading=false;if(a.loadingInterval){window.clearInterval(a.loadingInterval)}var b=a.getContext("2d");if(b){b.clearRect(0,0,a.width,a.height)}}};(function(){function b(){this.tapTimeLimit=500}Array.prototype.each=function(d,f,c){f=f||0;c=c||this.length-1;for(var e=f;e<=c;e++){d(this[e],this,e);if(this.breakLoop){this.breakLoop=false;break}}};b.prototype={preventDefaultEvent:function(c){if(c.preventDefault){c.preventDefault()}else{c.returnValue=false}},isTouchDevice:function(){return !!("ontouchstart" in window)},toMoney:function(c){return c.toFixed(2)},bigNumberToText:function(d){var c;var f=d/100000000;if(f>1){c=f.toFixed(2)+"亿"}else{var e=d/10000;if(e>1){c=e.toFixed()+"万"}else{c=d}}return c},getOffset:function(c){if(!isNaN(c.offsetX)&&!isNaN(c.offsetY)){return c}var h=c.target;if(h.offsetLeft==undefined){h=h.parentNode}var g=getPageCoord(h);var d={x:window.pageXOffset+c.clientX,y:window.pageYOffset+c.clientY};var f={offsetX:d.x-g.x,offsetY:d.y-g.y};return f},getPageCoord:function(d){var c={x:0,y:0};while(d){c.x+=d.offsetLeft;c.y+=d.offsetTop;d=d.offsetParent}return c},addLoadEvent:function(c){var d=window.onload;if(typeof d!="function"){window.onload=c}else{window.onload=function(){d();c()}}},addEvent:function(c,d,e,g){if(c.addEventListener){c.addEventListener(d,e,g);return true}else{if(c.attachEvent){var f=c.attachEvent("on"+d,e);return f}else{c["on"+d]=e}}},getEventTarget:function(c){return c.srcElement||c.target||c.relatedTarget},$id:function(c){return document.getElementById(c)}};window.extendObject=function(e,c){for(var d in e){c[d]=e[d]}};window.extendWindow=function(c){extendObject(c,window)};var a=new b();extendWindow(a);window.getQueryParam=function(f,c){var e=new RegExp("[?&]"+f+"=([^&]+)","i");var d=e.exec(c?window.top.location.search:location.search);if(d&&d.length>1){return decodeURIComponent(d[1])}else{return""}};window.debug=getQueryParam("debug");window.setDebugMsg=function(d){if(window.debug){try{var f="debug";var e=$id(f);if(!e){e=document.createElement("DIV");e.id=f;document.body.appendChild(e)}e.innerHTML=(window.debug==2?(d+"<br/>"+e.innerHTML):d)}catch(c){alert(d+";error:"+c)}}}})();(function(){function a(){}a.prototype={_clear:function(b){this.ctxs[b.id].clearRect(0,0,b.width,b.height)},_createLayer:function(d,b){if(!d.id){alert("_createCanvas必须指定id");return}if(!this.layers){this.layers={}}if(!this.ctxs){this.ctxs={}}if(!this.drawOptions){this.drawOptions={}}if(this.layers[d.id]){if(b!==false){this._clear(this.layers[d.id])}}else{var e=this.maxZIndex++;var c=document.createElement("canvas");c.id=d.id;c.style.position="absolute";c.style.zIndex=e;c.style.left=this.coords.x+d.left+"px";c.style.top=this.coords.y+d.top+"px";c.width=(d.width||(this.width-d.left));c.height=(d.height||(this.height-d.top));if(this.debug&&d.debug_backgroundColor){c.style.backgroundColor=d.debug_backgroundColor}document.body.appendChild(c);this.layers[d.id]=c;this.ctxs[d.id]=c.getContext("2d");this.drawOptions[d.id]=d}return this.ctxs[d.id]},_drawRect:function(e,g,h,k,f,b,d,c,i,j){i=i||0;j=j||0;e.beginPath();e.rect(g+i,h+j,k,f);e.lineWidth=d||0;e.strokeStyle=c;e.stroke()},_drawLine:function(c,f,g,j,k,b,l,h,i){h=h||0;i=i||0;c.beginPath();var m=f+h;var o=g+i;var n=j+h;var p=k+i;var d=(o==p);var e=(m==n);if(d){if(o*10%10==0){o+=0.5;p+=0.5}}if(e){if(m*10%10==0){m+=0.5;n+=0.5}}c.moveTo(m,o);c.lineTo(n,p);c.strokeStyle=b||"#000000";c.lineWidth=l||1;c.stroke()},_drawText:function(d,f,g,h,e,c,b){d.font=(e||"9pt 宋体");d.textAlign=(b||"left");d.fillStyle=(c||"Black");d.fillText(f,g,h)},_measureText:function(b,d,c){if(c){b.font=c}var e=b.measureText(d).width;return e},_getLayer:function(b){return this.layers[this.canvasId+"_"+b]},_getContext:function(b){return this.ctxs[this.canvasId+"_"+b]},_getOptions:function(b){return this.drawOptions[this.canvasId+"_"+b]}};window._painter=new a()})();var Ajax={};Ajax.request=function(e,g,a,c,f){f=f==undefined?true:f;var d=(window.ActiveXObject?new ActiveXObject("Microsoft.XMLHTTP"):(window.XMLHttpRequest?new XMLHttpRequest():false));var b=document.getElementById(c);if(b&&f){b.loadingObj=new loading(b);b.loadingObj.show()}d.onreadystatechange=function(){if(d.readyState==4&&d.status==200){if(b&&f){b.loadingObj.hide()}a(d)}};d.open(e||"POST",g,true);if(d.overrideMimeType){d.overrideMimeType("text/xml")}d.send()};Ajax.get=function(d,a,b,c){Ajax.request("GET",d,a,b,c)};Ajax.post=function(d,a,b,c){Ajax.request("POST",d,a,b,c)};function disableBubbleAndPreventDefault(a){if(a.preventDefault){a.preventDefault()}a.cancelBubble=true}function setTouchEventOffsetPosition(a,d){a=a||event;if(a.touches&&a.touches.length){a=a.touches[0]}else{if(a.changedTouches&&a.changedTouches.length){a=a.changedTouches[0]}}var b,c;b=a.pageX-d.x;c=a.pageY-d.y;return{offsetX:b,offsetY:c}}function crossLinesAndTipMgr(a,b){if(typeof Tip!="function"){window.Tip=function(){};window.Tip.prototype={show:function(){},hide:function(){},update:function(){}}}this.canvas=a;this.options=b}crossLinesAndTipMgr.prototype._removeTipAndCrossLines=function(){var a=this;if(a.tip){a.tip.hide()}if(a.clsMgr){a.clsMgr.removeCrossLines()}};crossLinesAndTipMgr.prototype.updateOptions=function(a){this.options=a};crossLinesAndTipMgr.prototype._onMouseOrTouchMove=function(f){f=f||event;f=getOffset(f);var g=this;var h=g.options;var a=g.canvas;var b=getPageCoord(a);var i=h.triggerEventRanges;if(f.offsetX<i.x||f.offsetX>i.x+i.width||f.offsetY<i.y||f.offsetY>i.y+i.height){g._removeTipAndCrossLines();return}var e=h.getCrossPoint(f);var d={crossPoint:e,verticalRange:{y1:i.y,y2:i.y+i.height},horizontalRange:{x1:i.x,x2:i.x+i.width},color:h.crossLineOptions.color,canvas:a};if(!g.clsMgr){var c=new crossLines(d);c.setMouseEvents(function(l){l=l||event;l=getOffset(l);var n={offsetX:l.offsetX+i.x,offsetY:parseInt(g.clsMgr.getHLine().style.top)-b.y};var m=h.getCrossPoint(n);c.updateCrossPoint(m);if(g.tip){g.tip.update(m,h.tipOptions.getTipHtml(n))}},function(l){l=l||event;l=getOffset(l);var n={offsetX:parseInt(g.clsMgr.getVLine().style.left)-b.x,offsetY:l.offsetY+i.y};var m=h.getCrossPoint(n);c.updateCrossPoint(m);if(g.tip){g.tip.update(m,h.tipOptions.getTipHtml(n))}});g.clsMgr=c}else{g.clsMgr.updateOptions(d)}g.clsMgr.drawCrossLines();if(h.tipOptions){var k=h.tipOptions;if(!g.tip){var j=new Tip({position:{x:k.position.x||false,y:k.position.y||false},size:k.size,opacity:k.opacity||80,cssClass:k.cssClass,offsetToPoint:k.offsetToPoint||30,relativePoint:{x:e.x,y:e.y},canvas:a,canvasRange:h.triggerEventRanges,innerHTML:k.getTipHtml(f)});g.tip=j}g.tip.show(e,k.getTipHtml(f))}};crossLinesAndTipMgr.prototype._touchstart=function(a){a=a||event;disableBubbleAndPreventDefault(a);var b=a.srcElement||a.target||a.relatedTarget;this.touchstartTime=new Date()};crossLinesAndTipMgr.prototype._touchmove=function(b){b=b||event;disableBubbleAndPreventDefault(b);var a=this.canvas;var d=getPageCoord(a);var f=b.srcElement||b.target||b.relatedTarget;var c=setTouchEventOffsetPosition(b,d);this._onMouseOrTouchMove(c)};crossLinesAndTipMgr.prototype._touchend=function(b){b=b||event;disableBubbleAndPreventDefault(b);var d=b.srcElement||b.target||b.relatedTarget;var a=this.canvas;var c=setTouchEventOffsetPosition(b,getPageCoord(a));this._removeTipAndCrossLines();var f=new Date();var g=f.getTime()-this.touchstartTime.getTime();if(g<200){if(typeof this.options.onClick=="function"){this.options.onClick()}}};crossLinesAndTipMgr.prototype._mouseout=function(b){var a=b||event;b=getOffset(a);var c=this;var d=c.options.triggerEventRanges;if(b.offsetX<=d.x||b.offsetX>=d.x+d.width||b.offsetY<=d.y||b.offsetY>=d.y+d.height){c._removeTipAndCrossLines();return}var f=a.toElement||a.relatedTarget||a.target;if(f){if(f==c.canvas){return}if(f==c.clsMgr.getHLine()||f==c.clsMgr.getVLine()){return}c._removeTipAndCrossLines()}};crossLinesAndTipMgr.prototype.addCrossLinesAndTipEvents=function(){var a=this.canvas;var d=this.options;var b=getPageCoord(a);if(a.addCrossLinesAndTipEvents==true){return}a.addCrossLinesAndTipEvents=true;var e=isTouchDevice();var c=this;if(e){addEvent(a,"touchstart",function(f){c._touchstart.call(c,f)});addEvent(a,"touchmove",function(f){c._touchmove.call(c,f)});addEvent(a,"touchend",function(f){c._touchend.call(c,f)})}else{addEvent(a,"mouseout",function(f){c._mouseout.call(c,f)});addEvent(a,"mousemove",function(f){c._onMouseOrTouchMove.call(c,f)});if(typeof d.onClick=="function"){addEvent(a,"click",d.onClick)}}};function addCrossLinesAndTipEvents(a,b){if(!a.crossLineAndTipMgrInstance){a.crossLineAndTipMgrInstance=new crossLinesAndTipMgr(a,b);a.crossLineAndTipMgrInstance.addCrossLinesAndTipEvents()}}function crossLines(a){this.updateOptions(a)}crossLines.prototype={updateOptions:function(a){this.canvas=a.canvas;this.canvasId=this.canvas.id;this.horizontalDivId=this.canvasId+"_crossLines_H";this.verticalDivId=this.canvasId+"_crossLines_V";this.verticalRange=a.verticalRange||{y1:0,y2:this.canvas.height};this.horizontalRange=a.horizontalRange||{x1:0,x2:this.canvas.width};this.canvasPosition=getPageCoord(this.canvas);this.crossPoint=a.crossPoint;this.color=a.color||"black"},removeCrossLines:function(){var a=this.canvas;var b=a.id;var c=b+"_crossLines_H";var f=b+"_crossLines_V";var d=$id(c);if(d){d.style.display="none"}var e=$id(f);if(e){e.style.display="none"}},getHLine:function(){return $id(this.horizontalDivId)},getVLine:function(){return $id(this.verticalDivId)},setMouseEvents:function(a,b){this.hLineMouseEvt=a;this.vLineMouseEvt=b},updateCrossPoint:function(a){this.crossPoint=a;this.drawCrossLines()},drawCrossLines:function(){var a=this.canvas;var b=this.canvas.id;var f=b+"_crossLines_H";var i=b+"_crossLines_V";var h=this.verticalRange||{y1:0,y2:a.height};var g=this.horizontalRange||{x1:0,x2:a.width};var c=this.canvasPosition;if(this.crossPoint.x<g.x1||this.crossPoint.x>g.x2||this.crossPoint.y<h.y1||this.crossPoint.y>h.y2){this.removeCrossLines();return}var k=(a.style.zIndex||1)+1;var d=false;var e;if($id(f)){d=true;e=$id(f)}else{e=document.createElement("DIV");e.id=f}e.style.display="block";e.style.position="absolute";e.style.width=Math.round(g.x2-g.x1)+"px";e.style.height="1px";e.style.left=Math.round(c.x+g.x1)+"px";e.style.top=Math.round(this.crossPoint.y+c.y)+"px";e.style.backgroundColor=this.color;e.style.zIndex=k;if(!d){document.body.appendChild(e);if(typeof this.hLineMouseEvt=="function"){addEvent(e,"mouseover",this.hLineMouseEvt);addEvent(e,"mousemove",this.hLineMouseEvt)}}d=false;var j;if($id(i)){d=true;j=$id(i)}else{j=document.createElement("DIV");j.id=i}j.style.display="block";j.style.position="absolute";j.style.height=Math.round(h.y2-h.y1)+"px";j.style.width="1px";j.style.left=Math.round(this.crossPoint.x+c.x)+"px";j.style.top=Math.round(h.y1+c.y)+"px";j.style.backgroundColor=this.color;j.style.index=k;if(!d){document.body.appendChild(j);if(typeof this.vLineMouseEvt=="function"){addEvent(j,"mouseover",this.vLineMouseEvt);addEvent(j,"mousemove",this.vLineMouseEvt)}}}};function Tip(a){this.options=a;this.canvas=a.canvas;this.canvas.tip=this}Tip.prototype={show:function(f,b){var a=this.dataContext;var e=this.canvas.MCP;if(a){var g=e._getOptions("title");if(a.isNewQuote){e.drawTitle(g)}else{var d;var c=a.index;if(c<a.data.length&&c>-1){minPrice=a.data[c].price;d=a.data[c].time}else{minPrice=this.quote.price;d=this.quote.time}e.drawTitle(g,d,minPrice)}}},update:function(b,a){this.show(b,a)},hide:function(){var a=this.canvas.MCP;var b=a._getOptions("title");a.drawTitle(b)}};(function(){function minutesChartPainter(options){this.canvasId=options.canvasId;if(!this.canvasId){alert("必须指定canvasId");return}this.riseColor=options.riseColor||"red";this.fallColor=options.fallColor||"green";this.normalColor=options.normalColor||"black";for(var k in options){this[k]=options[k]}this.canvas=$id(this.canvasId);this.canUseCanvas=this.canvas.getContext;if(this.canUseCanvas){this.ctx=this.canvas.getContext("2d");this.ctxs={};this.ctxs[options.canvasId]=this.ctx;this.width=this.canvas.width;this.height=this.canvas.height;this.coords=getPageCoord(this.canvas);this.maxZIndex=this.canvas.style.zIndex||1}extendObject(options,this);extendObject(window._painter,this)}var MCP=window.MCP=minutesChartPainter;MCP.prototype.loadData=function(completeCallback){if(this.debug&&this.useFakeData){this.quotes=getQuote();this.quote=this.quotes.quote;this.mins=this.quotes.mins;completeCallback();return}var painter=this;if(!painter.isFirstLoaded){painter.isFirstLoaded=true}var dataUrl=this.dataUrl+(this.dataUrl.indexOf("?")>0?"&":"?")+"random="+(new Date()).getTime();Ajax.get(dataUrl,function(ajax){function getNodeValue(parent,childName,i){return eval(parent.getElementsByTagName(childName)[i||0].textContent)}var dom=ajax.responseXML;var rootNode=dom.getElementsByTagName("HexunQuote")[0];var miniFlashNode=rootNode.getElementsByTagName("MiniFlash")[0];var commodityNode=miniFlashNode.getElementsByTagName("Commodity")[0];var quoteNode=commodityNode.getElementsByTagName("Quote")[0];var quoteNodeItem=quoteNode.getElementsByTagName("Item")[0];var quote={time:getNodeValue(quoteNodeItem,"TM",0),open:getNodeValue(quoteNodeItem,"OP",0),preClose:getNodeValue(quoteNodeItem,"PC",0),highest:getNodeValue(quoteNodeItem,"HI",0),lowest:getNodeValue(quoteNodeItem,"LO",0),price:getNodeValue(quoteNodeItem,"PR",0),volume:getNodeValue(quoteNodeItem,"VO",0),amount:getNodeValue(quoteNodeItem,"AM",0)};if(painter.quote&&quote.time==painter.quote.time&&quote.price==painter.quote.price){return}var mins=new Array();var minNodes=dom.firstChild.firstChild.firstChild.firstChild.nextSibling.getElementsByTagName("Item");for(var i=0;i<minNodes.length;i++){var minNode=minNodes[i];var min={price:getNodeValue(minNode,"PR",0),volume:getNodeValue(minNode,"VO",0),amount:getNodeValue(minNode,"AM",0)};mins.push(min)}painter.quotes={quote:quote,mins:mins};painter.quote=quote;painter.mins=mins;completeCallback();painter.isFirstLoaded=false},this.canvasId,(painter.isFirstLoaded===true))};MCP.prototype.drawTitle=function(options,quoteTime,price){options.height=options.height||this.height;options.width=options.width||this.width;options.id=this.canvasId+"_title";options.debug_backgroundColor="#f0f0f0";var offsetY=options.offsetY||0;var offsetX=options.offsetX||0;var preClose=preClose||this.quote.preClose;price=price||this.quote.price;var time=quoteTime||this.quote.time;var ctx=this._createLayer(options,true);var fontColor=options.fontColor||"Black";ctx.textAlign=options.textAlign||"left";var txtNewest="最新"+price;ctx.font=options.font||"9pt 宋体";ctx.fillStyle=fontColor;var titleWidth=this._measureText(ctx,txtNewest);var paddingBottom=options.paddingBottom||2;var titleY=options.height-paddingBottom;ctx.fillText(txtNewest,offsetX,titleY);var isRise=price>preClose;var isEqual=price==preClose;var isFall=price<preClose;var diff=toMoney(price-preClose);var txtRiseFall=(isRise?"↑":(isFall?"↓":""))+diff+("(")+toMoney(diff*100/preClose)+"%)";ctx.fillStyle=isRise?this.riseColor:(isFall?this.fallColor:this.normalColor);var riseFallWidth=this._measureText(ctx,txtRiseFall);ctx.fillText(txtRiseFall,offsetX+titleWidth+2,titleY);var temp=new String(time);var txtTime=temp.charAt(8)+temp.charAt(9)+":"+temp.charAt(10)+temp.charAt(11);ctx.fillStyle=fontColor;var timeWidth=this._measureText(ctx,txtTime);var timePaddingRight=options.timePaddingRight||4;ctx.fillText(txtTime,options.width-timeWidth-timePaddingRight,titleY)};MCP.prototype._getRiseFallColor=function(price){var preClose=this.quote.preClose;var isRise=price>preClose;var isEqual=price==preClose;var isFall=price<preClose;return isRise?this.riseColor:(isFall?this.fallColor:this.normalColor)};MCP.prototype.drawContent=function(options){options.id=this.canvasId+"_content";options.offsetX=options.offsetX||0;options.offsetY=options.offsetY||0;options.debug_backgroundColor="white";var ctx=this._createLayer(options,true);this._drawRect(ctx,0,0,options.width,options.height,options.backgroundColor,1,options.borderColor,options.offsetX,options.offsetY);var middleY=options.height/2;this._drawLine(ctx,0,middleY,options.width,middleY,options.middleBorderColor,1,options.offsetX,options.offsetY);var lineY=options.height/4;this._drawLine(ctx,0,lineY,options.width,lineY,options.backgroundBorderColor,1,options.offsetX,options.offsetY);lineY=options.height*3/4;this._drawLine(ctx,0,lineY,options.width,lineY,options.backgroundBorderColor,1,options.offsetX,options.offsetY);var position=this.noonAtTimelinePosition||0.5;var noonX=options.width*position;this._drawLine(ctx,noonX,0,noonX,options.height,options.backgroundBorderColor,1,options.offsetX,options.offsetY);noonX=noonX/2;this._drawLine(ctx,noonX,0,noonX,options.height,options.backgroundBorderColor,1,options.offsetX,options.offsetY);noonX=options.width*(position+(1-position)/2);this._drawLine(ctx,noonX,0,noonX,options.height,options.backgroundBorderColor,1,options.offsetX,options.offsetY);this._drawText(ctx,"点击查看大图",options.offsetX+options.width/2,options.offsetY+options.height/2-4,"9pt 宋体","#666666","center");var quote=this.quote;var mins=this.mins;var priceDiffMax=Math.max(Math.abs(quote.preClose-quote.highest),Math.abs(quote.preClose-quote.lowest));var pricePerPx=(options.height/2)/priceDiffMax;this.pricePerPx=pricePerPx;var getPriceYPx=function(val){var diff=val-quote.preClose;return middleY-diff*pricePerPx};var getTimeXPx=function(minIndex,minsCount){return options.offsetX+options.width*minIndex/minsCount};var getMinTime=this.getTimeByIndex;ctx.beginPath();for(var i=0;i<mins.length;i++){var priceY=getPriceYPx(this.mins[i].price);var priceX=getTimeXPx(i,this.minsCount);if(i==0){ctx.moveTo(priceX,priceY)}else{ctx.lineTo(priceX,priceY)}this.mins[i].y=priceY;this.mins[i].x=priceX;this.mins[i].time="yyyyMMdd"+getMinTime(i)}ctx.strokeStyle=options.priceLineColor;ctx.lineWidth=options.priceLineWidth;ctx.stroke();var canvas=this.layers[options.id];if(canvas.hasAddEvents){return}canvas.style.cursor="pointer";canvas.MCP=this;var me=this;function getY(x){var index=Math.ceil((x-options.offsetX)*me.minsCount/options.width);var val;var isNewQuote;if(index>=0&&index<mins.length){val=mins[index].price;isNewQuote=false}else{val=quote.price;isNewQuote=true}if(canvas.tip){canvas.tip.dataContext={data:mins,isNewQuote:isNewQuote,index:index}}var diff=val-quote.preClose;var middleY=(options.offsetY+options.height/2);return middleY-diff*options.height/2/priceDiffMax}function getX(x){var index=Math.ceil((x-options.offsetX)*me.minsCount/options.width);var val;if(index<0){index=0}if(index>=mins.length){index=mins.length-1}return getTimeXPx(index,me.minsCount)}addCrossLinesAndTipEvents(canvas,{getCrossPoint:function(ev){return{x:getX(ev.offsetX),y:getY(ev.offsetX)}},triggerEventRanges:{x:options.offsetX,y:options.offsetY,width:options.width,height:options.height},tipOptions:{getTipHtml:function(ev){return null},position:{x:false,y:false}},crossLineOptions:{color:"black"},onClick:options.onClick})};MCP.prototype.drawTimeAxis=function(options){var font=options.font||"9pt Arial";var color=options.color||"black";var timeOpen=this.timeOpen;var timeNoon=this.timeNoon;var timeClose=this.timeClose;options.id=this.canvasId+"_timeAxis";options.offsetX=options.offsetX||0;options.offsetY=options.offsetY||0;options.debug_backgroundColor="yellow";var ctx=this._createLayer(options,true);ctx.font=font;var fontWidth=this._measureText(ctx,timeOpen);var fontY=options.fontY||options.height;this._drawText(ctx,timeOpen,options.offsetX,fontY,font,color);var fontNoonWidth=this._measureText(ctx,timeNoon);var fontCloseWidth=this._measureText(ctx,timeClose);var padding=options.timeCloseRightPadding||2;var xNoon=options.offsetX+options.width*(this.noonAtTimelinePosition||0.5)-fontNoonWidth/2;var xClose=options.offsetX+options.width-fontCloseWidth-padding;if(xNoon+fontNoonWidth>xClose){xNoon=xClose-fontNoonWidth-padding}this._drawText(ctx,timeNoon,xNoon,fontY,font,color);this._drawText(ctx,timeClose,xClose,fontY,font,color)};MCP.prototype.drawFoot=function(options){var font=options.font||"9pt Arial";var color=options.color||"black";options.id=this.canvasId+"_foot";options.offsetX=options.offsetX||0;options.offsetY=options.offsetY||0;options.debug_backgroundColor="#ffffff";var ctx=this._createLayer(options,true);var txt="高";var paddingLeft=options.paddingLeft||2;var w=paddingLeft+this._measureText(ctx,txt,font);var y=options.height-(options.paddingTop||2);this._drawText(ctx,txt,paddingLeft,y,font,color);var highColor=this._getRiseFallColor(this.quote.highest);var high=this.quote.highest.toFixed(2);this._drawText(ctx,high,w,y,font,highColor);w+=this._measureText(ctx,high,font);txt=" 低";this._drawText(ctx,txt,w,y,font,color);w+=this._measureText(ctx,txt,font);var lowColor=this._getRiseFallColor(this.quote.lowest);var low=this.quote.lowest.toFixed(2);this._drawText(ctx,low,w,y,font,lowColor);w+=this._measureText(ctx,low,font);var amount;if(this.showTradeType=="volume"){if(this.quote.volume){amount=" 成交"+bigNumberToText(this.quote.volume)+"手"}}else{if(this.quote.amount){amount=" 成交"+bigNumberToText(this.quote.amount)}}if(amount){this._drawText(ctx,amount,w,y,font,color)}};MCP.prototype.drawPriceAxis=function(options){};MCP.prototype.paint=function(){if(!this.canUseCanvas){return}var mcp=this;var loadDataCallback=function(){if(mcp.titleOptions){mcp.drawTitle(mcp.titleOptions)}mcp.drawContent(mcp.contentOptions);if(mcp.priceAxisOptions){mcp.drawPriceAxis(mcp.priceAxisOptions)}if(mcp.timeAxisOptions){mcp.drawTimeAxis(mcp.timeAxisOptions)}if(mcp.footOptions){mcp.drawFoot(mcp.footOptions)}if(mcp.customPainter&&typeof(mcp.customPainter.method)=="function"){mcp.customPainter.method(mcp.customPainter.options,mcp)}};mcp.loadData(loadDataCallback);window.mcp.intervalHandler=window.setInterval(function(){mcp.loadData(loadDataCallback)},window.mcp.interval)};MCP.prototype.updateDataUrl=function(dataUrl){this.dataUrl=dataUrl;window.clearInterval(this.intervalHandler);this.isFirstLoaded=false;this.paint()}})();
</script>
<!---->
     <script>
addLoadEvent(function(){var a=new MCP({timeOpen:"09:30",timeNoon:"11:30/13:00",timeClose:"15:00",showTradeType:"amount",noonAtTimelinePosition:0.5,getTimeByIndex:function(e){var b=new Date();if(e<=120){b.setHours(9,30,30);b=new Date(b.getTime()+(e)*60*1000)}else{b.setHours(13,0,0);b=new Date(b.getTime()+(e-120)*60*1000)}var c=b.getHours()>9?new String(b.getHours()):"0"+b.getHours();var f=b.getMinutes()>9?new String(b.getMinutes()):"0"+b.getMinutes();var g="30";return c+f+g},canvasId:"canvasMCP",interval:10000,minsCount:241,dataUrl:"http://minpic.quote.stock.hexun.com/Stock_QTMI/QTMI_1_000001.xml",titleOptions:{left:4,top:0,height:20,width:0,paddingBottom:4,timePaddingRight:4},contentOptions:{left:2,top:20,height:85,width:155,borderColor:"#444444",priceLineColor:"#2358A6",priceLineWidth:1,middleBorderColor:"#ff0000",backgroundBorderColor:"#d6d6d6",backgroundColor:"#ffffff",onClick:function(){window.open("http://stockdata.stock.hexun.com/indexhq_000001_1.shtml")}},timeAxisOptions:{left:2,top:105,width:155,height:18,font:"9pt Arial",fontY:14,timeOpen:"09:30",timeNoon:"11:30/13:00",timeClose:"15:00",timeCloseRightPadding:2},footOptions:{left:2,top:123,height:18,width:0,paddingTop:4,paddingLeft:0,font:"9pt 宋体",color:"black"},customPainter:{method:function(g,h){var f=h.canvasId+"_menu";var c=$id(f);var d=(c!=null);if(!d){c=document.createElement("DIV");c.id=f;c.className="menu";var k=g.sections;for(var e=0;e<k.length;e++){var j=k[e];var b=document.createElement("A");b.innerHTML=j.text;b.href=j.url;b.className=j.cssClass;b.target=j.target||"_blank";c.appendChild(b)}}c.style.display="block";c.style.position="absolute";c.style.width=g.width+"px";c.style.height=g.height+"px";c.style.left=g.left+h.coords.x+"px";c.style.top=g.top+h.coords.y+"px";if(!d){document.body.appendChild(c)}},options:{left:158,top:18,width:214-158,height:146-20-18,sections:[{text:"行情中心",url:"http://quote.hexun.com/",cssClass:"menuItem"},{text:"资金流向",url:"http://quote.hexun.com/",cssClass:"menuItem"},{text:"微博解盘",url:"http://quote.hexun.com/",cssClass:"menuItem"},{text:"操盘软件",url:"http://quote.hexun.com/",cssClass:"menuItem focus"}]}},debug:false,useFakeData:false});window.mcp=a;window.mcp.paint()});
</script>
    <style type="text/css">
        .menu{display:none}
        .menuItem{border: 1px solid #666;color: #666;display: block;font-size: 9pt;font-family: Arial,宋体;margin: 2px;text-decoration: none;line-height: 16px;text-align: center;}
        .focus{background: #FFCC66;}
    </style>
    <script type="text/javascript" src="mins-data.js"></script>
</head>
<body>
    <div>
        <canvas id="canvasMCP" width="214" height="146" style="z-index: 3;">
            <p>
                你的浏览器不支持html5哟</p>
        </canvas>
        <div id="canvasMCP_menu" class="menu">
            <a href="http://quote.hexun.com/" target="_blank" class="menuItem">行情中心</a>
            <a href="http://quote.hexun.com/" target="_blank" class="menuItem">资金流向</a>
            <a href="http://quote.hexun.com/" target="_blank" class="menuItem">价格预测</a>
            <a href="http://quote.hexun.com/" target="_blank" class="menuItem">微博解盘</a>
            <a href="http://quote.hexun.com/" target="_blank" class="menuItem">操盘软件</a>
        </div>
    </div>
</body>
</html>
