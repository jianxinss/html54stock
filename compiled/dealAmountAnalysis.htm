<!doctype html>
<html>
<head>
    <meta http-equiv="content-type" content="text/html;charset=GBK" />
    <title>成交金额分析</title>
    <script>
var Ajax={};Ajax.request=function(e,g,a,c,f){f=f==undefined?true:f;var d=(window.ActiveXObject?new ActiveXObject("Microsoft.XMLHTTP"):(window.XMLHttpRequest?new XMLHttpRequest():false));var b=document.getElementById(c);if(b&&f){b.loadingObj=new loading(b);b.loadingObj.show()}d.onreadystatechange=function(){if(d.readyState==4&&d.status==200){if(b&&f){b.loadingObj.hide()}a(d)}};d.open(e||"POST",g,true);if(d.overrideMimeType){d.overrideMimeType("text/xml")}d.send()};Ajax.get=function(d,a,b,c){Ajax.request("GET",d,a,b,c)};Ajax.post=function(d,a,b,c){Ajax.request("POST",d,a,b,c)};function XmlParser(a){this.doc=a}XmlParser.prototype={getChildValue:function(f,d,b){b=b||0;var c=-1;for(var e=0;e<f.childNodes.length;e++){var a=f.childNodes[e];if(a.nodeName==d){c+=1;if(c==b){return a.firstChild.data}}}return null},getValue:function(e){var a=this.doc;var h=e.split("/");var f=[];var d=a;for(var b=0;b<h.length;b++){var g=h[b];if(g==""){continue}if(g.charAt(0)=="@"){g=g.substring(1,g.length);return d.getAttribute(g)}var c=g.indexOf("[");if(c>0){nodeName=g.substring(0,c);c=g.substr(c+1,g.length-c-2);d=this._getChildren(d,nodeName)[c]}else{d=this._getChildren(d,g)[0]}}return d.nodeValue},getNode:function(f){var a=this.doc;var j=f.split("/");var g=a;var d;for(var b=0;b<j.length;b++){var h=j[b];if(h==""){continue}if(b>0&&d){g=d;d=null}var e;var c=h.indexOf("[");if(c>0){e=h.substring(0,c);c=h.substr(c+1,h.length-c-2);d=this._getChildren(g,e)[c]}else{d=this._getChildren(g,h)[0]}}return d},getNodes:function(m){var a=this.doc;var p=m.split("/");var n=[];n.push(a);var g=[];for(var b=0;b<p.length;b++){var o=p[b];if(o==""){continue}if(b>0&&g.length){n=g;g=[]}var h;var f;var c=o.indexOf("[");if(c>0){h=o.substring(0,c);c=o.substr(c+1,o.length-c-2);for(var d=0;d<n.length;d++){f=this._getChildren(n[d],h)[c];g.push(f)}}else{for(var d=0;d<n.length;d++){var l=this._getChildren(n[d],o);for(var e=0;e<l.length;e++){g.push(l[e])}}}}return g},_getChildren:function(c,b){var d=[];if(c.childNodes.length){for(var a=0;a<c.childNodes.length;a++){if(c.childNodes[a].nodeName==b){d.push(c.childNodes[a])}}}return d}};function loading(a,b){this.canvas=(typeof a=="String"?document.getElementById(a):a);if(b){this.radius=b.radius||10;this.circleLineWidth=b.circleLineWidth||4;this.circleColor=b.circleColor||"lightgray";this.dotColor=b.dotColor||"gray"}else{this.radius=10;this.circelLineWidth=4;this.circleColor="lightgray";this.dotColor="gray"}}loading.prototype={show:function(){var a=this.canvas;if(!a.getContext){return}if(a.__loading){return}a.__loading=this;var b=a.getContext("2d");var d=this.radius;var e=[{angle:0,radius:1.5},{angle:3/d,radius:2},{angle:7/d,radius:2.5},{angle:12/d,radius:3}];var c=this;a.loadingInterval=setInterval(function(){b.clearRect(0,0,a.width,a.height);var h=c.circleLineWidth;var f={x:a.width/2-d,y:a.height/2-d};b.beginPath();b.lineWidth=h;b.strokeStyle=c.circleColor;b.arc(f.x,f.y,d,0,Math.PI*2);b.closePath();b.stroke();for(var g=0;g<e.length;g++){var j=e[g].currentAngle||e[g].angle;var k={x:f.x-(d)*Math.cos(j),y:f.y-(d)*Math.sin(j)};var l=e[g].radius;b.beginPath();b.fillStyle=c.dotColor;b.arc(k.x,k.y,l,0,Math.PI*2);b.closePath();b.fill();e[g].currentAngle=j+4/d}},50)},hide:function(){var a=this.canvas;a.__loading=false;if(a.loadingInterval){window.clearInterval(a.loadingInterval)}var b=a.getContext("2d");if(b){b.clearRect(0,0,a.width,a.height)}}};var dashSize=2;function Painter(a,c,b){this.canvas=document.getElementById(a);if(!this.canvas.getContext){return}this.ctx=this.canvas.getContext("2d");this.data=b;this.paintImplement=c;this.width=this.canvas.width;this.height=this.canvas.height}Painter.prototype={paint:function(){var e=this.paintImplement;var b=this.data;var a=this.ctx;if(typeof e.initialize=="function"){e.initialize(this)}if(e.start){e.start.call(this)}if(typeof e.paintItems=="function"){e.paintItems.call(this)}else{var c=((typeof e.getDataLength=="function")?e.getDataLength.call(this):this.data.length);for(var d=0;d<c;d++){var f=e.getX?e.getX.call(this,d):undefined;var g=e.getY?e.getY.call(this,d):undefined;e.paintItem.call(this,d,f,g)}}if(e.end){e.end.call(this)}},drawHLine:function(a,g,h,e,d,c){var b=this.ctx;b.strokeStyle=a;if(h*10%10==0){h+=0.5}if(c&&c=="dashed"){var f=0;do{this.drawHLine(a,f,h,dashSize,1,"solid");f+=dashSize*2}while(f<e)}else{b.beginPath();b.moveTo(g,h);b.lineTo(g+e,h);b.stroke()}},drawVLine:function(a,g,i,c,f,e){var b=this.ctx;b.strokeStyle=a;if(g*10%10==0){g+=0.5}if(e&&e=="dashed"){var d=0;do{this.drawVLine(a,g,d,dashSize,1);d+=dashSize*2}while(d<c)}else{b.beginPath();b.moveTo(g,i);b.lineTo(g,i+c);b.stroke()}},setData:function(a){this.data=a},setPainterImplement:function(a){this.paintImplement=a}};(function(){function b(){this.tapTimeLimit=500}Array.prototype.each=function(d,f,c){f=f||0;c=c||this.length-1;for(var e=f;e<=c;e++){d(this[e],this,e);if(this.breakLoop){this.breakLoop=false;break}}};b.prototype={preventDefaultEvent:function(c){if(c.preventDefault){c.preventDefault()}else{c.returnValue=false}},isTouchDevice:function(){return !!("ontouchstart" in window)},toMoney:function(c){return c.toFixed(2)},bigNumberToText:function(d){var c;var f=d/100000000;if(f>1){c=f.toFixed(2)+"亿"}else{var e=d/10000;if(e>1){c=e.toFixed()+"万"}else{c=d}}return c},getOffset:function(c){if(!isNaN(c.offsetX)&&!isNaN(c.offsetY)){return c}var h=c.target;if(h.offsetLeft==undefined){h=h.parentNode}var g=getPageCoord(h);var d={x:window.pageXOffset+c.clientX,y:window.pageYOffset+c.clientY};var f={offsetX:d.x-g.x,offsetY:d.y-g.y};return f},getPageCoord:function(d){var c={x:0,y:0};while(d){c.x+=d.offsetLeft;c.y+=d.offsetTop;d=d.offsetParent}return c},addLoadEvent:function(c){var d=window.onload;if(typeof d!="function"){window.onload=c}else{window.onload=function(){d();c()}}},addEvent:function(c,d,e,g){if(c.addEventListener){c.addEventListener(d,e,g);return true}else{if(c.attachEvent){var f=c.attachEvent("on"+d,e);return f}else{c["on"+d]=e}}},getEventTarget:function(c){return c.srcElement||c.target||c.relatedTarget},$id:function(c){return document.getElementById(c)}};window.extendObject=function(e,c){for(var d in e){c[d]=e[d]}};window.extendWindow=function(c){extendObject(c,window)};var a=new b();extendWindow(a);window.getQueryParam=function(f,c){var e=new RegExp("[?&]"+f+"=([^&]+)","i");var d=e.exec(c?window.top.location.search:location.search);if(d&&d.length>1){return decodeURIComponent(d[1])}else{return""}};window.debug=getQueryParam("debug");window.setDebugMsg=function(d){if(window.debug){try{var f="debug";var e=$id(f);if(!e){e=document.createElement("DIV");e.id=f;document.body.appendChild(e)}e.innerHTML=(window.debug==2?(d+"<br/>"+e.innerHTML):d)}catch(c){alert(d+";error:"+c)}}}})();function xAxis(a){this.options=a}xAxis.prototype={initialize:function(a){a.options=this.options},start:function(){var a=this.ctx;a.save();a.fillStyle=this.options.color;a.font=this.options.font;if(this.options.textBaseline){a.textBaseline=this.options.textBaseline}a.translate(this.options.region.x,this.options.region.y)},getY:function(){return 0},getX:function(a){if(a==0){return 0}var b=this.ctx.measureText(this.data[a]).width;if(a==this.data.length-1){return this.options.region.width-b}return(this.options.region.width*a/(this.data.length-1))-b/2},paintItem:function(a,b,c){this.ctx.fillText(this.data[a],b,c)},end:function(){this.ctx.restore()}};function yAxis(a){this.scalerOptions=a}yAxis.prototype={initialize:function(a){a.scalerOptions=this.scalerOptions},start:function(){var a=this.ctx;a.save();if(typeof this.scalerOptions.color=="string"){a.fillStyle=this.scalerOptions.color}a.font=this.scalerOptions.font;a.translate(this.scalerOptions.region.x,this.scalerOptions.region.y);if(this.scalerOptions.textBaseline){a.textBaseline=this.scalerOptions.textBaseline}},end:function(){this.ctx.restore()},getX:function(a){if(this.scalerOptions.align=="left"){return 0}var b=this.ctx.measureText(this.data[a]).width;return this.scalerOptions.region.width-b},getY:function(a){if(a==0){return 0}if(a==this.data.length-1){return this.scalerOptions.region.height-this.scalerOptions.fontHeight}return(this.scalerOptions.region.height*a/(this.data.length-1)-this.scalerOptions.fontHeight/2)},paintItem:function(a,b,c){if(typeof this.scalerOptions.color=="function"){this.ctx.fillStyle=this.scalerOptions.color(this.data[a])}this.ctx.fillText(this.data[a],b,c)}};function calcAxisValues(d,f,a,c){var b=d-f;var h=b/(a-1);var g=[];if(typeof c=="undefined"){c=toMoney}for(var e=0;e<a;e++){g.push(toMoney(d-e*h))}return g}function crossLines(a){this.updateOptions(a)}crossLines.prototype={updateOptions:function(a){this.canvas=a.canvas;this.canvasId=this.canvas.id;this.horizontalDivId=this.canvasId+"_crossLines_H";this.verticalDivId=this.canvasId+"_crossLines_V";this.verticalRange=a.verticalRange||{y1:0,y2:this.canvas.height};this.horizontalRange=a.horizontalRange||{x1:0,x2:this.canvas.width};this.canvasPosition=getPageCoord(this.canvas);this.crossPoint=a.crossPoint;this.color=a.color||"black"},removeCrossLines:function(){var a=this.canvas;var b=a.id;var c=b+"_crossLines_H";var f=b+"_crossLines_V";var d=$id(c);if(d){d.style.display="none"}var e=$id(f);if(e){e.style.display="none"}},getHLine:function(){return $id(this.horizontalDivId)},getVLine:function(){return $id(this.verticalDivId)},setMouseEvents:function(a,b){this.hLineMouseEvt=a;this.vLineMouseEvt=b},updateCrossPoint:function(a){this.crossPoint=a;this.drawCrossLines()},drawCrossLines:function(){var a=this.canvas;var b=this.canvas.id;var f=b+"_crossLines_H";var i=b+"_crossLines_V";var h=this.verticalRange||{y1:0,y2:a.height};var g=this.horizontalRange||{x1:0,x2:a.width};var c=this.canvasPosition;if(this.crossPoint.x<g.x1||this.crossPoint.x>g.x2||this.crossPoint.y<h.y1||this.crossPoint.y>h.y2){this.removeCrossLines();return}var k=(a.style.zIndex||1)+1;var d=false;var e;if($id(f)){d=true;e=$id(f)}else{e=document.createElement("DIV");e.id=f}e.style.display="block";e.style.position="absolute";e.style.width=Math.round(g.x2-g.x1)+"px";e.style.height="1px";e.style.left=Math.round(c.x+g.x1)+"px";e.style.top=Math.round(this.crossPoint.y+c.y)+"px";e.style.backgroundColor=this.color;e.style.zIndex=k;if(!d){document.body.appendChild(e);if(typeof this.hLineMouseEvt=="function"){addEvent(e,"mouseover",this.hLineMouseEvt);addEvent(e,"mousemove",this.hLineMouseEvt)}}d=false;var j;if($id(i)){d=true;j=$id(i)}else{j=document.createElement("DIV");j.id=i}j.style.display="block";j.style.position="absolute";j.style.height=Math.round(h.y2-h.y1)+"px";j.style.width="1px";j.style.left=Math.round(this.crossPoint.x+c.x)+"px";j.style.top=Math.round(h.y1+c.y)+"px";j.style.backgroundColor=this.color;j.style.index=k;if(!d){document.body.appendChild(j);if(typeof this.vLineMouseEvt=="function"){addEvent(j,"mouseover",this.vLineMouseEvt);addEvent(j,"mousemove",this.vLineMouseEvt)}}}};function Tip(a){extendObject(a,this)}Tip.prototype={getElementId:function(){return this.canvas.id+"_tip"},_getRightLimit:function(){return this.canvasRange.x+this.canvasRange.width},_getLeftLimit:function(){return this.canvasRange.x},_getTopLimit:function(){return this.canvasRange.y},_getBottomLimit:function(){return this.canvasRange.y+this.canvasRange.height},show:function(i,d){if(i){this.relativePoint=i}if(d){this.innerHTML=d}var g=$id(this.getElementId());var j=this.size;var e=this.offsetToPoint;var h=this.position;var i=this.relativePoint;var a=getPageCoord(this.canvas);var n=h.y||i.y;var m=h.x||i.x;var k=0;var l=0;if(h.x){k=h.x}else{if(g){var b=parseInt(g.style.left)-a.x;if(b>m){if(e+m+j.width>this._getRightLimit()){b=m-e-j.width}else{b=m+e}}else{if(m-e-j.width>this._getLeftLimit()){b=m-e-j.width}else{b=m+e}}k=b}else{k=m+e;if(k>this._getRightLimit()){k=m-e-j.width}}}if(h.y){l=h.y}else{if(g){var c=parseInt(g.style.top)-a.y;if(c>n){if(e+n+j.height>this._getBottomLimit()){c=n-e-j.height}else{c=n+e}}else{if(n-e-j.height>this._getTopLimit()){c=n-e-j.height}else{c=n+e}}l=c}else{l=n+e;if(l>this._getBottomLimit()){l=n-e-j.height}}}if(!g){g=document.createElement("DIV");g.id=this.getElementId();var f=this.opacity||100;g.style.cssText="-moz-opacity:."+f+"; filter:alpha(opacity="+f+"); opacity:"+(f/100)+';line-height:18px;font-family:Arial,"宋体";font-size:9pt;padding:4px;';g.style.position="absolute";g.style.zIndex=4+(this.canvas.style.zIndex||1);g.style.backgroundColor="white";g.style.border="1px solid gray";g.style.width=this.size.width+"px";g.style.height=this.size.height+"px";if(this.cssClass){g.className=this.cssClass}document.body.appendChild(g)}k=a.x+k;l=a.y+l;g.style.left=k+"px";g.style.top=l+"px";g.style.display="block";g.innerHTML=this.innerHTML},hide:function(){var a=$id(this.getElementId());if(a){a.style.display="none"}},update:function(b,a){this.relativePoint=b;this.innerHTML=a;this.show()}};function disableBubbleAndPreventDefault(a){if(a.preventDefault){a.preventDefault()}a.cancelBubble=true}function setTouchEventOffsetPosition(a,d){a=a||event;if(a.touches&&a.touches.length){a=a.touches[0]}else{if(a.changedTouches&&a.changedTouches.length){a=a.changedTouches[0]}}var b,c;b=a.pageX-d.x;c=a.pageY-d.y;return{offsetX:b,offsetY:c}}function crossLinesAndTipMgr(a,b){if(typeof Tip!="function"){window.Tip=function(){};window.Tip.prototype={show:function(){},hide:function(){},update:function(){}}}this.canvas=a;this.options=b}crossLinesAndTipMgr.prototype._removeTipAndCrossLines=function(){var a=this;if(a.tip){a.tip.hide()}if(a.clsMgr){a.clsMgr.removeCrossLines()}};crossLinesAndTipMgr.prototype.updateOptions=function(a){this.options=a};crossLinesAndTipMgr.prototype._onMouseOrTouchMove=function(f){f=f||event;f=getOffset(f);var g=this;var h=g.options;var a=g.canvas;var b=getPageCoord(a);var i=h.triggerEventRanges;if(f.offsetX<i.x||f.offsetX>i.x+i.width||f.offsetY<i.y||f.offsetY>i.y+i.height){g._removeTipAndCrossLines();return}var e=h.getCrossPoint(f);var d={crossPoint:e,verticalRange:{y1:i.y,y2:i.y+i.height},horizontalRange:{x1:i.x,x2:i.x+i.width},color:h.crossLineOptions.color,canvas:a};if(!g.clsMgr){var c=new crossLines(d);c.setMouseEvents(function(l){l=l||event;l=getOffset(l);var n={offsetX:l.offsetX+i.x,offsetY:parseInt(g.clsMgr.getHLine().style.top)-b.y};var m=h.getCrossPoint(n);c.updateCrossPoint(m);if(g.tip){g.tip.update(m,h.tipOptions.getTipHtml(n))}},function(l){l=l||event;l=getOffset(l);var n={offsetX:parseInt(g.clsMgr.getVLine().style.left)-b.x,offsetY:l.offsetY+i.y};var m=h.getCrossPoint(n);c.updateCrossPoint(m);if(g.tip){g.tip.update(m,h.tipOptions.getTipHtml(n))}});g.clsMgr=c}else{g.clsMgr.updateOptions(d)}g.clsMgr.drawCrossLines();if(h.tipOptions){var k=h.tipOptions;if(!g.tip){var j=new Tip({position:{x:k.position.x||false,y:k.position.y||false},size:k.size,opacity:k.opacity||80,cssClass:k.cssClass,offsetToPoint:k.offsetToPoint||30,relativePoint:{x:e.x,y:e.y},canvas:a,canvasRange:h.triggerEventRanges,innerHTML:k.getTipHtml(f)});g.tip=j}g.tip.show(e,k.getTipHtml(f))}};crossLinesAndTipMgr.prototype._touchstart=function(a){a=a||event;disableBubbleAndPreventDefault(a);var b=a.srcElement||a.target||a.relatedTarget;this.touchstartTime=new Date()};crossLinesAndTipMgr.prototype._touchmove=function(b){b=b||event;disableBubbleAndPreventDefault(b);var a=this.canvas;var d=getPageCoord(a);var f=b.srcElement||b.target||b.relatedTarget;var c=setTouchEventOffsetPosition(b,d);this._onMouseOrTouchMove(c)};crossLinesAndTipMgr.prototype._touchend=function(b){b=b||event;disableBubbleAndPreventDefault(b);var d=b.srcElement||b.target||b.relatedTarget;var a=this.canvas;var c=setTouchEventOffsetPosition(b,getPageCoord(a));this._removeTipAndCrossLines();var f=new Date();var g=f.getTime()-this.touchstartTime.getTime();if(g<200){if(typeof this.options.onClick=="function"){this.options.onClick()}}};crossLinesAndTipMgr.prototype._mouseout=function(b){var a=b||event;b=getOffset(a);var c=this;var d=c.options.triggerEventRanges;if(b.offsetX<=d.x||b.offsetX>=d.x+d.width||b.offsetY<=d.y||b.offsetY>=d.y+d.height){c._removeTipAndCrossLines();return}var f=a.toElement||a.relatedTarget||a.target;if(f){if(f==c.canvas){return}if(f==c.clsMgr.getHLine()||f==c.clsMgr.getVLine()){return}c._removeTipAndCrossLines()}};crossLinesAndTipMgr.prototype.addCrossLinesAndTipEvents=function(){var a=this.canvas;var d=this.options;var b=getPageCoord(a);if(a.addCrossLinesAndTipEvents==true){return}a.addCrossLinesAndTipEvents=true;var e=isTouchDevice();var c=this;if(e){addEvent(a,"touchstart",function(f){c._touchstart.call(c,f)});addEvent(a,"touchmove",function(f){c._touchmove.call(c,f)});addEvent(a,"touchend",function(f){c._touchend.call(c,f)})}else{addEvent(a,"mouseout",function(f){c._mouseout.call(c,f)});addEvent(a,"mousemove",function(f){c._onMouseOrTouchMove.call(c,f)});if(typeof d.onClick=="function"){addEvent(a,"click",d.onClick)}}};function addCrossLinesAndTipEvents(a,b){if(!a.crossLineAndTipMgrInstance){a.crossLineAndTipMgrInstance=new crossLinesAndTipMgr(a,b);a.crossLineAndTipMgrInstance.addCrossLinesAndTipEvents()}}function linePainter(a){this.options=a}linePainter.prototype={initialize:function(a){a.options=this.options},getDataLength:function(){return this.options.getDataLength.call(this)},getX:function(a){return(a+1)*(this.options.region.width/this.options.maxDotsCount)},start:function(){var a=this.ctx;var d=this.options;var e=d.region;a.save();a.translate(e.x,e.y+e.height/2);var b=0;var c=this;this.data.items.each(function(g){var f=Math.abs(d.middleValue-d.getItemValue(g));b=Math.max(f,b)});this.maxDiff=b;a.beginPath();a.strokeStyle=d.lineColor},end:function(){this.ctx.stroke();this.ctx.restore()},getY:function(b){var c=this.options;var a=c.getItemValue(this.data.items[b])-c.middleValue;return 0-a*c.region.height/2/this.maxDiff},paintItem:function(b,c,d){var a=this.ctx;if(b==0){a.moveTo(c,d)}else{a.lineTo(c,d)}}};
</script>
</head>
<body>
    <canvas id="canvas" width="500" height="400" style="border: 1px solid lightgray">
    </canvas>
    <script>
var canvasId="canvas";var options={region:{x:60,y:50,width:400,height:320,borderColor:"lightgray"},minsCount:241,bar:{width:1,flowInColor:"red",flowOutColor:"green"},priceLineColor:"#6699cc",priceColors:{rise:"red",fall:"green",normal:"black"},titleOptions:{font:"Bold 11px 宋体",position:{x:15,y:5},color:"black",textBaseline:"top"},flowUnitOptions:{font:"11px 宋体",position:{x:30,y:28},color:"black",textBaseline:"top"},stockNameOptions:{font:"11px 宋体",position:{x:400,y:28},color:"black",textBaseline:"top"},xAxis:{font:"11px Arial",region:{x:60,y:373,height:30,width:400},color:"black",textBaseline:"top"},yAxisFlow:{font:"11px Arial",region:{x:0,y:47,height:320,width:55},color:"black",align:"right",fontHeight:8,textBaseline:"top"},yAxisPrice:{font:"11px Arial",region:{x:462,y:47,height:320,width:48},color:"black",align:"left",fontHeight:8,textBaseline:"top"}};var implementFlowInOut={start:function(){var a=this.ctx;var e=options.region;a.beginPath();a.strokeStyle=e.borderColor;a.rect(e.x,e.y,e.width,e.height);a.closePath();a.stroke();function b(h,g){if(g){a.fillStyle=g.color;a.font=g.font;if(g.textBaseline){a.textBaseline=g.textBaseline}a.fillText(h,g.position.x,g.position.y)}}b(this.data.title,options.titleOptions);b("("+this.data.flowUnit+")",options.flowUnitOptions);b(this.data.stock,options.stockNameOptions);a.save();a.translate(e.x,e.y+e.height/2);var c=[0,e.height/6,e.height*2/6,0-e.height/6,0-e.height*2/6];var d=this;c.each(function(g){d.drawHLine(e.borderColor,0,g,e.width)});var f=[e.width/4,e.width/2,e.width*3/4];f.each(function(g){d.drawVLine(e.borderColor,g,0-e.height/2,e.height)});maxFlow=0;this.data.items.each(function(g){var h=Math.max(g.flowIn,g.flowOut);maxFlow=Math.max(h,maxFlow)});this.maxFlow=maxFlow},getDataLength:function(){return this.data.items.length},getX:function(a){return(a+1)*(options.region.width/options.minsCount)},paintItem:function(b,c,d){var a=this.ctx;a.beginPath();var d=this.data.items[b].flowIn/this.maxFlow*options.region.height/2;a.rect(c,0-d,options.bar.width,d);a.fillStyle=options.bar.flowInColor;a.fill();a.beginPath();var d=this.data.items[b].flowOut/this.maxFlow*options.region.height/2;a.rect(c,0,options.bar.width,d);a.fillStyle=options.bar.flowOutColor;a.fill()},end:function(){this.ctx.restore()}};Ajax.get("dealAmountAnalysis.xml",function(b){var e=b.responseXML;var r=new XmlParser(e);var c={title:r.getValue("Data/Title/@name"),stock:r.getValue("Data/Item[1]/Title/@name"),preClose:r.getValue("Data/Item[1]/Title/@close"),flowUnit:r.getValue("Data/Item[0]/Title/@unit")};var l=[];var m=r.getNodes("Data/Item[0]/Item");var u=r.getNodes("Data/Item[1]/Item");for(var j=0;j<m.length;j++){var o=m[j];var z=o.getAttribute("date");if(z<"09:30"){continue}var k=l.length;l[k]={time:z,flowIn:parseFloat(o.getAttribute("inflow")),flowOut:parseFloat(o.getAttribute("outflow"))}}function h(F){if(F<=120){F+=30;var G=F%60;var E=9+(F-G)/60;if(E<10){E="0"+E}if(G<10){G="0"+G}return E+":"+G}else{F=F-121;var G=F%60;var E=13+(F-G)/60;if(G<10){G="0"+G}return E+":"+G}}for(var j=0;j<u.length;j++){if(j<l.length){l[j].price=u[j].getAttribute("price")}else{l[l.length]={time:h(j),price:u[j].getAttribute("price"),flowIn:0,flowOut:0}}}c.items=l;var p=new Painter(canvasId,implementFlowInOut,c);p.paint();var t=new linePainter({region:options.region,maxDotsCount:options.minsCount,getDataLength:function(){return this.data.items.length},getItemValue:function(i){return i.price},middleValue:parseFloat(c.preClose),lineColor:options.priceLineColor});var q=new Painter(canvasId,t,c);q.paint();var s=parseFloat(c.preClose);var a=$id(canvasId);function g(E){var i=Math.ceil((E-options.region.x)*options.minsCount/options.region.width);if(i>l.length-1){i=l.length-1}return i}addCrossLinesAndTipEvents(a,{getCrossPoint:function(E){E=E||event;getOffset(E);var i=g(E.offsetX);var F=options.region.x+t.getX.call(q,i);return{x:F,y:E.offsetY}},triggerEventRanges:{x:options.region.x,y:options.region.y,width:options.region.width,height:options.region.height},tipOptions:{getTipHtml:function(F){F=F||event;getOffset(F);var i=g(F.offsetX);if(i>=0&&i<l.length){var E=l[i];return"时　　间："+E.time+'<br/>流入资金：<font color="'+options.priceColors.rise+'">'+E.flowIn+"("+c.flowUnit+')</font><br/>流出资金：<font color="'+options.priceColors.fall+'">'+E.flowOut+"("+c.flowUnit+')</font><br/>价　　格：<font color="'+(E.price>s?options.priceColors.rise:options.priceColors.fall)+'">'+parseFloat(E.price).toFixed(2)+"</font>"}},position:{x:false,y:options.region.y+options.region.height/5},size:{width:150,height:80},opacity:80,cssClass:null,offsetToPoint:30},crossLineOptions:{color:"black"}});var A=new xAxis(options.xAxis);var B=new Painter(canvasId,A,["09:30","10:30","11:00/13:00","14:00","15:00"]);B.options=A.options;B.paint();var x=[];x.push(p.maxFlow.toFixed(2));x.push((p.maxFlow*2/3).toFixed(2));x.push((p.maxFlow/3).toFixed(2));x.push(0);x.push("-"+(p.maxFlow/3).toFixed(2));x.push("-"+(p.maxFlow*2/3).toFixed(2));x.push("-"+p.maxFlow.toFixed(2));var f=new yAxis(options.yAxisFlow);var C=new Painter(canvasId,f,x);C.scalerOptions=options.yAxisFlow;C.paint();var d=parseFloat(q.maxDiff);var n=s+d;var w=[];var y=d/3;for(var j=0;j<7;j++){w.push((n-j*y).toFixed(2))}options.yAxisPrice.color=function(i){if(parseFloat(i)>s){return options.priceColors.rise}else{if(parseFloat(i)==s){return options.priceColors.normal}}return options.priceColors.fall};var v=new yAxis(options.yAxisPrice);var D=new Painter(canvasId,v,w);D.scalerOptions=options.yAxisPrice;D.paint()},canvasId,true);
</script>
</body>
</html>
