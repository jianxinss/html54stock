<!doctype html >
<html>
    <head>
        <meta http-equiv="content-type" content="text/html;charset=GBK" />
        <title>资金流向盘中分价统计图</title>
    <script>
(function(){function b(){this.tapTimeLimit=500}Array.prototype.each=function(d,f,c){f=f||0;c=c||this.length-1;for(var e=f;e<=c;e++){d(this[e],this,e);if(this.breakLoop){this.breakLoop=false;break}}};b.prototype={preventDefaultEvent:function(c){if(c.preventDefault){c.preventDefault()}else{c.returnValue=false}},isTouchDevice:function(){return !!("ontouchstart" in window)},toMoney:function(c){return c.toFixed(2)},bigNumberToText:function(d){var c;var f=d/100000000;if(f>1){c=f.toFixed(2)+"亿"}else{var e=d/10000;if(e>1){c=e.toFixed()+"万"}else{c=d}}return c},getOffset:function(c){if(!isNaN(c.offsetX)&&!isNaN(c.offsetY)){return c}var h=c.target;if(h.offsetLeft==undefined){h=h.parentNode}var g=getPageCoord(h);var d={x:window.pageXOffset+c.clientX,y:window.pageYOffset+c.clientY};var f={offsetX:d.x-g.x,offsetY:d.y-g.y};return f},getPageCoord:function(d){var c={x:0,y:0};while(d){c.x+=d.offsetLeft;c.y+=d.offsetTop;d=d.offsetParent}return c},addLoadEvent:function(c){var d=window.onload;if(typeof d!="function"){window.onload=c}else{window.onload=function(){d();c()}}},addEvent:function(c,d,e,g){if(c.addEventListener){c.addEventListener(d,e,g);return true}else{if(c.attachEvent){var f=c.attachEvent("on"+d,e);return f}else{c["on"+d]=e}}},getEventTarget:function(c){return c.srcElement||c.target||c.relatedTarget},$id:function(c){return document.getElementById(c)}};window.extendObject=function(e,c){for(var d in e){c[d]=e[d]}};window.extendWindow=function(c){extendObject(c,window)};var a=new b();extendWindow(a);window.getQueryParam=function(f,c){var e=new RegExp("[?&]"+f+"=([^&]+)","i");var d=e.exec(c?window.top.location.search:location.search);if(d&&d.length>1){return decodeURIComponent(d[1])}else{return""}};window.debug=getQueryParam("debug");window.setDebugMsg=function(d){if(window.debug){try{var f="debug";var e=$id(f);if(!e){e=document.createElement("DIV");e.id=f;document.body.appendChild(e)}e.innerHTML=(window.debug==2?(d+"<br/>"+e.innerHTML):d)}catch(c){alert(d+";error:"+c)}}}})();function crossLines(a){this.updateOptions(a)}crossLines.prototype={updateOptions:function(a){this.canvas=a.canvas;this.canvasId=this.canvas.id;this.horizontalDivId=this.canvasId+"_crossLines_H";this.verticalDivId=this.canvasId+"_crossLines_V";this.verticalRange=a.verticalRange||{y1:0,y2:this.canvas.height};this.horizontalRange=a.horizontalRange||{x1:0,x2:this.canvas.width};this.canvasPosition=getPageCoord(this.canvas);this.crossPoint=a.crossPoint;this.color=a.color||"black"},removeCrossLines:function(){var a=this.canvas;var b=a.id;var c=b+"_crossLines_H";var f=b+"_crossLines_V";var d=$id(c);if(d){d.style.display="none"}var e=$id(f);if(e){e.style.display="none"}},getHLine:function(){return $id(this.horizontalDivId)},getVLine:function(){return $id(this.verticalDivId)},setMouseEvents:function(a,b){this.hLineMouseEvt=a;this.vLineMouseEvt=b},updateCrossPoint:function(a){this.crossPoint=a;this.drawCrossLines()},drawCrossLines:function(){var a=this.canvas;var b=this.canvas.id;var f=b+"_crossLines_H";var i=b+"_crossLines_V";var h=this.verticalRange||{y1:0,y2:a.height};var g=this.horizontalRange||{x1:0,x2:a.width};var c=this.canvasPosition;if(this.crossPoint.x<g.x1||this.crossPoint.x>g.x2||this.crossPoint.y<h.y1||this.crossPoint.y>h.y2){this.removeCrossLines();return}var k=(a.style.zIndex||1)+1;var d=false;var e;if($id(f)){d=true;e=$id(f)}else{e=document.createElement("DIV");e.id=f}e.style.display="block";e.style.position="absolute";e.style.width=Math.round(g.x2-g.x1)+"px";e.style.height="1px";e.style.left=Math.round(c.x+g.x1)+"px";e.style.top=Math.round(this.crossPoint.y+c.y)+"px";e.style.backgroundColor=this.color;e.style.zIndex=k;if(!d){document.body.appendChild(e);if(typeof this.hLineMouseEvt=="function"){addEvent(e,"mouseover",this.hLineMouseEvt);addEvent(e,"mousemove",this.hLineMouseEvt)}}d=false;var j;if($id(i)){d=true;j=$id(i)}else{j=document.createElement("DIV");j.id=i}j.style.display="block";j.style.position="absolute";j.style.height=Math.round(h.y2-h.y1)+"px";j.style.width="1px";j.style.left=Math.round(this.crossPoint.x+c.x)+"px";j.style.top=Math.round(h.y1+c.y)+"px";j.style.backgroundColor=this.color;j.style.index=k;if(!d){document.body.appendChild(j);if(typeof this.vLineMouseEvt=="function"){addEvent(j,"mouseover",this.vLineMouseEvt);addEvent(j,"mousemove",this.vLineMouseEvt)}}}};function Tip(a){extendObject(a,this)}Tip.prototype={getElementId:function(){return this.canvas.id+"_tip"},_getRightLimit:function(){return this.canvasRange.x+this.canvasRange.width},_getLeftLimit:function(){return this.canvasRange.x},_getTopLimit:function(){return this.canvasRange.y},_getBottomLimit:function(){return this.canvasRange.y+this.canvasRange.height},show:function(i,d){if(i){this.relativePoint=i}if(d){this.innerHTML=d}var g=$id(this.getElementId());var j=this.size;var e=this.offsetToPoint;var h=this.position;var i=this.relativePoint;var a=getPageCoord(this.canvas);var n=h.y||i.y;var m=h.x||i.x;var k=0;var l=0;if(h.x){k=h.x}else{if(g){var b=parseInt(g.style.left)-a.x;if(b>m){if(e+m+j.width>this._getRightLimit()){b=m-e-j.width}else{b=m+e}}else{if(m-e-j.width>this._getLeftLimit()){b=m-e-j.width}else{b=m+e}}k=b}else{k=m+e;if(k>this._getRightLimit()){k=m-e-j.width}}}if(h.y){l=h.y}else{if(g){var c=parseInt(g.style.top)-a.y;if(c>n){if(e+n+j.height>this._getBottomLimit()){c=n-e-j.height}else{c=n+e}}else{if(n-e-j.height>this._getTopLimit()){c=n-e-j.height}else{c=n+e}}l=c}else{l=n+e;if(l>this._getBottomLimit()){l=n-e-j.height}}}if(!g){g=document.createElement("DIV");g.id=this.getElementId();var f=this.opacity||100;g.style.cssText="-moz-opacity:."+f+"; filter:alpha(opacity="+f+"); opacity:"+(f/100)+';line-height:18px;font-family:Arial,"宋体";font-size:9pt;padding:4px;';g.style.position="absolute";g.style.zIndex=4+(this.canvas.style.zIndex||1);g.style.backgroundColor="white";g.style.border="1px solid gray";g.style.width=this.size.width+"px";g.style.height=this.size.height+"px";if(this.cssClass){g.className=this.cssClass}document.body.appendChild(g)}k=a.x+k;l=a.y+l;g.style.left=k+"px";g.style.top=l+"px";g.style.display="block";g.innerHTML=this.innerHTML},hide:function(){var a=$id(this.getElementId());if(a){a.style.display="none"}},update:function(b,a){this.relativePoint=b;this.innerHTML=a;this.show()}};eval(function(h,b,d,g,f,i){f=function(a){return(a<b?"":f(parseInt(a/b)))+((a=a%b)>35?String.fromCharCode(a+29):a.toString(36))};if(!"".replace(/^/,String)){while(d--){i[f(d)]=g[d]||f(d)}g=[function(a){return i[a]}];f=function(){return"\\w+"};d=1}while(d--){if(g[d]){h=h.replace(new RegExp("\\b"+f(d)+"\\b","g"),g[d])}}return h}("o C(a,b){6.z=a;m(b){6.9=b.9||12;6.w=b.w||4;6.n=b.n||'A';6.p=b.p||'E'}T{6.9=12;6.S=4;6.n='A';6.p='E'}}C.Q={N:o(){8 f=6.z;m(!f.u)H;m(f.v)H;f.v=6;8 g=f.u('K');8 h=6.9;8 j=[{l:0,9:1.5},{l:3/h,9:2},{l:7/h,9:2.5},{l:12/h,9:3}];8 k=6;f.r=L(o(){g.I(0,0,f.s,f.t);8 a=k.w;8 b={x:f.s/2-h,y:f.t/2-h};g.B();g.14=a;g.W=k.n;g.D(b.x,b.y,h,0,q.F*2);g.G();g.O();P(8 i=0;i<j.R;i++){8 c=j[i].J||j[i].l;8 d={x:b.x-(h)*q.U(c),y:b.y-(h)*q.V(c)};8 e=j[i].9;g.B();g.X=k.p;g.D(d.x,d.y,e,0,q.F*2);g.G();g.Y();j[i].J=c+4/h}},Z)},10:o(){8 a=6.z;a.v=11;m(a.r){13.M(a.r)}8 b=a.u('K');m(b)b.I(0,0,a.s,a.t)}};",62,67,"||||||this||var|radius||||||||||||angle|if|circleColor|function|dotColor|Math|loadingInterval|width|height|getContext|__loading|circleLineWidth|||canvas|lightgray|beginPath|loading|arc|gray|PI|closePath|return|clearRect|currentAngle|2d|setInterval|clearInterval|show|stroke|for|prototype|length|circelLineWidth|else|cos|sin|strokeStyle|fillStyle|fill|50|hide|false||window|lineWidth".split("|"),0,{}));var Ajax={};Ajax.request=function(e,g,a,c,f){f=f==undefined?true:f;var d=(window.ActiveXObject?new ActiveXObject("Microsoft.XMLHTTP"):(window.XMLHttpRequest?new XMLHttpRequest():false));var b=document.getElementById(c);if(b&&f){b.loadingObj=new loading(b);b.loadingObj.show()}d.onreadystatechange=function(){if(d.readyState==4&&d.status==200){if(b&&f){b.loadingObj.hide()}a(d)}};d.open(e||"POST",g,true);if(d.overrideMimeType){d.overrideMimeType("text/xml")}d.send()};Ajax.get=function(d,a,b,c){Ajax.request("GET",d,a,b,c)};Ajax.post=function(d,a,b,c){Ajax.request("POST",d,a,b,c)};function disableBubbleAndPreventDefault(a){if(a.preventDefault){a.preventDefault()}a.cancelBubble=true}function setTouchEventOffsetPosition(a,d){a=a||event;if(a.touches&&a.touches.length){a=a.touches[0]}else{if(a.changedTouches&&a.changedTouches.length){a=a.changedTouches[0]}}var b,c;b=a.pageX-d.x;c=a.pageY-d.y;return{offsetX:b,offsetY:c}}function crossLinesAndTipMgr(a,b){if(typeof Tip!="function"){window.Tip=function(){};window.Tip.prototype={show:function(){},hide:function(){},update:function(){}}}this.canvas=a;this.options=b}crossLinesAndTipMgr.prototype._removeTipAndCrossLines=function(){var a=this;if(a.tip){a.tip.hide()}if(a.clsMgr){a.clsMgr.removeCrossLines()}};crossLinesAndTipMgr.prototype.updateOptions=function(a){this.options=a};crossLinesAndTipMgr.prototype._onMouseOrTouchMove=function(f){f=f||event;f=getOffset(f);var g=this;var h=g.options;var a=g.canvas;var b=getPageCoord(a);var i=h.triggerEventRanges;if(f.offsetX<i.x||f.offsetX>i.x+i.width||f.offsetY<i.y||f.offsetY>i.y+i.height){g._removeTipAndCrossLines();return}var e=h.getCrossPoint(f);var d={crossPoint:e,verticalRange:{y1:i.y,y2:i.y+i.height},horizontalRange:{x1:i.x,x2:i.x+i.width},color:h.crossLineOptions.color,canvas:a};if(!g.clsMgr){var c=new crossLines(d);c.setMouseEvents(function(l){l=l||event;l=getOffset(l);var n={offsetX:l.offsetX+i.x,offsetY:parseInt(g.clsMgr.getHLine().style.top)-b.y};var m=h.getCrossPoint(n);c.updateCrossPoint(m);if(g.tip){g.tip.update(m,h.tipOptions.getTipHtml(n))}},function(l){l=l||event;l=getOffset(l);var n={offsetX:parseInt(g.clsMgr.getVLine().style.left)-b.x,offsetY:l.offsetY+i.y};var m=h.getCrossPoint(n);c.updateCrossPoint(m);if(g.tip){g.tip.update(m,h.tipOptions.getTipHtml(n))}});g.clsMgr=c}else{g.clsMgr.updateOptions(d)}g.clsMgr.drawCrossLines();if(h.tipOptions){var k=h.tipOptions;if(!g.tip){var j=new Tip({position:{x:k.position.x||false,y:k.position.y||false},size:k.size,opacity:k.opacity||80,cssClass:k.cssClass,offsetToPoint:k.offsetToPoint||30,relativePoint:{x:e.x,y:e.y},canvas:a,canvasRange:h.triggerEventRanges,innerHTML:k.getTipHtml(f)});g.tip=j}g.tip.show(e,k.getTipHtml(f))}};crossLinesAndTipMgr.prototype._touchstart=function(a){a=a||event;disableBubbleAndPreventDefault(a);var b=a.srcElement||a.target||a.relatedTarget;this.touchstartTime=new Date()};crossLinesAndTipMgr.prototype._touchmove=function(b){b=b||event;disableBubbleAndPreventDefault(b);var a=this.canvas;var d=getPageCoord(a);var f=b.srcElement||b.target||b.relatedTarget;var c=setTouchEventOffsetPosition(b,d);this._onMouseOrTouchMove(c)};crossLinesAndTipMgr.prototype._touchend=function(b){b=b||event;disableBubbleAndPreventDefault(b);var d=b.srcElement||b.target||b.relatedTarget;var a=this.canvas;var c=setTouchEventOffsetPosition(b,getPageCoord(a));this._removeTipAndCrossLines();var f=new Date();var g=f.getTime()-this.touchstartTime.getTime();if(g<200){if(typeof this.options.onClick=="function"){this.options.onClick()}}};crossLinesAndTipMgr.prototype._mouseout=function(b){var a=b||event;b=getOffset(a);var c=this;var d=c.options.triggerEventRanges;if(b.offsetX<=d.x||b.offsetX>=d.x+d.width||b.offsetY<=d.y||b.offsetY>=d.y+d.height){c._removeTipAndCrossLines();return}var f=a.toElement||a.relatedTarget||a.target;if(f){if(f==c.canvas){return}if(f==c.clsMgr.getHLine()||f==c.clsMgr.getVLine()){return}c._removeTipAndCrossLines()}};crossLinesAndTipMgr.prototype.addCrossLinesAndTipEvents=function(){var a=this.canvas;var d=this.options;var b=getPageCoord(a);if(a.addCrossLinesAndTipEvents==true){return}a.addCrossLinesAndTipEvents=true;var e=isTouchDevice();var c=this;if(e){addEvent(a,"touchstart",function(f){c._touchstart.call(c,f)});addEvent(a,"touchmove",function(f){c._touchmove.call(c,f)});addEvent(a,"touchend",function(f){c._touchend.call(c,f)})}else{addEvent(a,"mouseout",function(f){c._mouseout.call(c,f)});addEvent(a,"mousemove",function(f){c._onMouseOrTouchMove.call(c,f)});if(typeof d.onClick=="function"){addEvent(a,"click",d.onClick)}}};function addCrossLinesAndTipEvents(a,b){if(!a.crossLineAndTipMgrInstance){a.crossLineAndTipMgrInstance=new crossLinesAndTipMgr(a,b);a.crossLineAndTipMgrInstance.addCrossLinesAndTipEvents()}};
</script>
    </head>
    <body>
    <canvas id="canvas" width="400" height="500" style="border:1px solid #69c"></canvas>
    <div id="debug"></div>
    <script>
function moneyFlowAnalysisPainter(c,v,f){this.canvas=document.getElementById(c);if(!this.canvas.getContext){return}var a=this.canvas;var e=this.canvas.getContext("2d");var d=v.chartOptions;var h=v.dealUnitOptions;var g=f.items.length;d.height=Math.max(d.minHeight,g*d.itemHeight);var b=d.height+d.position.x+h.height;a.height=b;e.clearRect(0,0,a.width,a.height);function j(i){e.fillStyle=i.fontColor;e.font=i.font;if(i.textBaseline){e.textBaseline=i.textBaseline}e.fillText(i.text,i.position.x,i.position.y)}if(v.titleOptions){var B=v.titleOptions;B.text=f.title;j(B)}if(v.priceUnitOptions){j(v.priceUnitOptions)}if(v.flowInInstructionOptions){var u=v.flowInInstructionOptions;e.beginPath();e.rect(u.position.x,u.position.y,u.rectSize,u.rectSize);e.fillStyle=u.color;e.strokeStyle=u.strokeStyle||"lightGray";e.fill();e.stroke();u.position={x:u.position.x+u.fontOffset.left+u.rectSize,y:u.position.y+u.fontOffset.top};j(u)}if(v.flowOutInstructionOptions){var u=v.flowOutInstructionOptions;e.beginPath();e.rect(u.position.x,u.position.y,u.rectSize,u.rectSize);e.fillStyle=u.color;e.strokeStyle=u.strokeStyle||"lightGray";e.fill();e.stroke();u.position={x:u.position.x+u.fontOffset.left+u.rectSize,y:u.position.y+u.fontOffset.top};j(u)}e.beginPath();e.lineWidth=1;e.rect(d.position.x,d.position.y,d.width,d.height);e.strokeStyle=d.borderColor;e.closePath();e.stroke();e.lineWidth=1;var s=d.height/(d.itemHeight*2);for(var o=1;o<s;o++){e.beginPath();e.fillStyle=d.borderColor;var G=d.position.x;var H=d.position.y+o*d.itemHeight*2;e.rect(G,H,d.width,1);e.closePath();e.fill()}var F=[d.width/4,d.width/2,d.width/4*3];for(var o=0;o<F.length;o++){e.beginPath();e.fillStyle=d.borderColor;e.rect(d.position.x+F[o],d.position.y,1,d.height);e.closePath();e.fill()}var r=f.items;var t=0;for(var o=0;o<r.length;o++){t=Math.max(t,r[o].flowIn);t=Math.max(t,r[o].flowOut)}var k=v.flowInInstructionOptions.color;var l=v.flowOutInstructionOptions.color;var D="0.00";var C=d.height+d.position.y+2;e.fillStyle="black";var E=e.measureText(D).width;e.fillText(D,d.width/2+d.position.x-E/2,C);D=t.toFixed(2);E=e.measureText(D).width;e.fillStyle="red";e.fillText(D,d.width+d.position.x-E,C);D=(t/2).toFixed(2);E=e.measureText(D).width;e.fillText(D,d.width*3/4+d.position.x-E/2,C);D="-"+t.toFixed(2);e.fillStyle="green";e.fillText(D,d.position.x,C);D="-"+(t/2).toFixed(2);E=e.measureText(D).width;e.fillText(D,d.position.x+d.width/4-E/2,C);function n(i){return d.position.y+(i*2+1)*d.barSpace/2+i*d.barHeight}for(var o=0;o<r.length;o++){var q=r[o];var p=d.width/2*q.flowIn/t;var w=d.width/2*q.flowOut/t;var H=n(o);e.fillStyle=k;e.beginPath();e.rect(d.position.x+d.width/2,H,p,d.barHeight);e.closePath();e.fill();e.fillStyle=l;e.beginPath();e.rect(d.position.x+d.width/2-w,H,w,d.barHeight);e.closePath();e.fill();if(o%2==0){var z=new Number(q.priceRanges.to).toFixed(2);e.font=d.priceScalerTextFont;var A=e.measureText(z).width;var G=d.position.x-A+d.priceScalerOffset.right;H=d.position.y+d.itemHeight*(o+1)-d.priceScalerFontHeight/2+d.priceScalerOffset.top;e.fillStyle=d.priceScalerColor;e.textBaseline=d.priceScalerTextBaseline;e.fillText(z,G,H)}}function m(x){var i=Math.ceil((x-d.position.y)/(d.barSpace+d.barHeight))-1;if(i>=r.length){return r.length-1}return i}addCrossLinesAndTipEvents(a,{getCrossPoint:function(x){var i=m(x.offsetY);var I=n(i)+d.barHeight/2;return{x:x.offsetX,y:I}},triggerEventRanges:{x:d.position.x,y:d.position.y,width:d.width,height:d.height},tipOptions:{getTipHtml:function(y){var i=m(y.offsetY);if(i>=0&&i<r.length){var x=r[i];var I=Math.abs(x.flowIn)>Math.abs(x.flowOut);return"价格区间："+x.priceRanges.begin+" - "+x.priceRanges.to+'(元)<br/>流入资金：<font color="'+k+'">'+x.flowIn+"("+f.unit+')</font><br/>流出资金：<font color="'+l+'">'+x.flowOut+"("+f.unit+')</font><br/>差　　值：<font color="'+(I?k:l)+'">'+(Math.abs(x.flowIn)-Math.abs(x.flowOut)).toFixed(2)+"</font>"}},position:{x:d.position.x+d.width/6,y:false},size:{width:165,height:100},opacity:80,cssClass:null,offsetToPoint:30},crossLineOptions:{color:"red"}})}Ajax.get("dailyTradeAnalysis.xml",function(a){if(a.readyState==4&&(a.status==200||a.status==304)){var b=a.responseXML;var m=b.getElementsByTagName("Data")[0].getElementsByTagName("Title")[0];var l=m.getAttribute("name");var g=b.getElementsByTagName("Item")[0];var j=g.getElementsByTagName("Title")[0];var n=j.getAttribute("unit");var f=g.getElementsByTagName("Item");var h=[];for(var c=0;c<f.length;c++){var e=f[c];var d={priceRanges:{begin:e.getAttribute("price1"),to:e.getAttribute("price2")},flowIn:e.getAttribute("inflow"),flowOut:e.getAttribute("outflow")};h.push(d)}var k=new moneyFlowAnalysisPainter("canvas",{titleOptions:{position:{x:10,y:20},fontColor:"black",font:"Bold 12px Arial"},priceUnitOptions:{position:{x:24,y:38},fontColor:"black",font:"11px Arial",text:"(元)"},flowInInstructionOptions:{position:{x:180,y:33},color:"red",text:"流入性资金",font:"11px Arial",fontColor:"black",rectSize:12,textBaseline:"top",fontOffset:{left:2,top:-2}},flowOutInstructionOptions:{position:{x:280,y:33},color:"green",text:"流出性资金",font:"11px Arial",fontColor:"black",rectSize:12,textBaseline:"top",fontOffset:{left:2,top:-2}},chartOptions:{position:{x:50,y:50},width:330,itemHeight:9,barHeight:5,barSpace:4,borderColor:"gray",lineColor:"gray",minHeight:200,priceScalerTextFont:"11px Arial",priceScalerFontHeight:11,priceScalerColor:"black",priceScalerOffset:{right:-4,top:2},priceScalerTextBaseline:"alphabetic"},dealUnitOptions:{color:"red",font:"11px Arial",fontColor:"black",height:30}},{title:l,unit:n,items:h})}},"canvas");
</script>
    </body>
</html>
